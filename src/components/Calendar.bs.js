// Generated by ReScript, PLEASE EDIT WITH CARE

import Dayjs from "dayjs";
import * as React from "react";
import * as Caml_obj from "rescript/lib/es6/caml_obj.js";
import * as LogicUtils from "../utils/LogicUtils.bs.js";
import * as MatchMedia from "../context/MatchMedia.bs.js";
import * as Core__Array from "@rescript/core/src/Core__Array.bs.js";
import * as Core__Option from "@rescript/core/src/Core__Option.bs.js";
import * as TimeZoneHook from "../hooks/TimeZoneHook.bs.js";
import * as ThemeProvider from "../context/ThemeProvider.bs.js";
import * as AddDataAttributes from "./AddDataAttributes.bs.js";
import * as JsxPPXReactSupportU from "rescript/lib/es6/jsxPPXReactSupportU.js";

function defaultCellHighlighter(param) {
  return {
    highlightSelf: false,
    highlightLeft: false,
    highlightRight: false,
  };
}

function defaultCellRenderer(obj) {
  if (obj === undefined) {
    return "";
  }
  var day = obj.split("-");
  return Core__Option.getOr(day[2], "");
}

function Calendar$TableRow(props) {
  var allowedDateRange = props.allowedDateRange;
  var setShowMsg = props.setShowMsg;
  var dateRangeLimit = props.dateRangeLimit;
  var __customDisabledFutureDays = props.customDisabledFutureDays;
  var __disableFutureDates = props.disableFutureDates;
  var __disablePastDates = props.disablePastDates;
  var setHoverdDate = props.setHoverdDate;
  var hoverdDate = props.hoverdDate;
  var __endDate = props.endDate;
  var __startDate = props.startDate;
  var __cellRenderer = props.cellRenderer;
  var __cellHighlighter = props.cellHighlighter;
  var onDateClick = props.onDateClick;
  var year = props.year;
  var month = props.month;
  var item = props.item;
  var __changeHighlightCellStyle = props.changeHighlightCellStyle;
  var changeHighlightCellStyle =
    __changeHighlightCellStyle !== undefined ? __changeHighlightCellStyle : "";
  var cellHighlighter =
    __cellHighlighter !== undefined
      ? __cellHighlighter
      : defaultCellHighlighter;
  var cellRenderer =
    __cellRenderer !== undefined ? __cellRenderer : defaultCellRenderer;
  var startDate = __startDate !== undefined ? __startDate : "";
  var endDate = __endDate !== undefined ? __endDate : "";
  var disablePastDates =
    __disablePastDates !== undefined ? __disablePastDates : true;
  var disableFutureDates =
    __disableFutureDates !== undefined ? __disableFutureDates : false;
  var customDisabledFutureDays =
    __customDisabledFutureDays !== undefined ? __customDisabledFutureDays : 0.0;
  var match = React.useContext(ThemeProvider.themeContext);
  var textColor = match.globalUIConfig.font.textColor;
  var customTimezoneToISOString = TimeZoneHook.useCustomTimeZoneToIsoString();
  if (Caml_obj.equal(item, Core__Array.make(7, ""))) {
    return React.createElement("tr", {
      className: "h-0",
    });
  } else {
    return React.createElement(
      "tr",
      {
        className: "transition duration-300 ease-in-out",
      },
      item.map(function (obj, cellIndex) {
        var date = new Date(
          customTimezoneToISOString(
            String(year),
            String(month + 1.0),
            String(LogicUtils.isEmptyString(obj) ? "01" : obj),
            "00",
            "00",
            "00",
          ),
        );
        var dateToday = new Date();
        var todayInitial = dateToday.setHours(0.0, 0.0, 0.0, 0.0);
        var isInCustomDisable =
          customDisabledFutureDays > 0.0
            ? date.getTime() - todayInitial <=
              customDisabledFutureDays * 24.0 * 3600.0 * 1000.0
            : false;
        var dateNotInRange =
          allowedDateRange !== undefined &&
          LogicUtils.isNonEmptyString(allowedDateRange.startDate) &&
          LogicUtils.isNonEmptyString(allowedDateRange.endDate)
            ? !(
                date.getTime() -
                  new Date(allowedDateRange.startDate).getTime() >=
                  0.0 &&
                new Date(allowedDateRange.endDate).getTime() - date.getTime() >=
                  0.0
              )
            : false;
        var isFutureDate = disablePastDates
          ? todayInitial - date.getTime() <= 0.0
          : todayInitial - date.getTime() < 0.0;
        var isInLimit =
          dateRangeLimit !== undefined && LogicUtils.isNonEmptyString(startDate)
            ? date.getTime() - new Date(startDate).getTime() <
              ((dateRangeLimit - 1) * 24 * 60 * 60 - 60) * 1000
            : true;
        var onClick = function (_evt) {
          var isClickDisabled =
            (LogicUtils.isEmptyString(endDate) && !isInLimit) ||
            (isFutureDate ? disableFutureDates : disablePastDates) ||
            (customDisabledFutureDays > 0.0 && isInCustomDisable) ||
            dateNotInRange;
          if (!isClickDisabled && onDateClick !== undefined) {
            return onDateClick(Dayjs(date.toISOString()).format("YYYY-MM-DD"));
          }
        };
        var hSelf = cellHighlighter(
          Dayjs(date.toString()).format("YYYY-MM-DD"),
        );
        var dayClass =
          (isFutureDate && disableFutureDates) ||
          (customDisabledFutureDays > 0.0 && isInCustomDisable) ||
          (!isFutureDate && disablePastDates) ||
          (LogicUtils.isEmptyString(endDate) && !isInLimit) ||
          dateNotInRange
            ? "cursor-not-allowed"
            : "cursor-default";
        var getDate = function (date) {
          return new Date(
            Number(Core__Option.getOr(date[0], "")),
            Number(String(Number(Core__Option.getOr(date[1], "")) - 1.0)),
            Number(Core__Option.getOr(date[2], "")),
          );
        };
        var today = Dayjs(new Date().toString()).format("YYYY-MM-DD");
        var renderingDate = Dayjs(
          getDate([year.toString(), (month + 1.0).toString(), obj]).toString(),
        ).format("YYYY-MM-DD");
        var textColor$1 =
          today === renderingDate
            ? textColor.primaryNormal
            : "text-jp-gray-900 text-opacity-75 dark:text-opacity-75";
        var classN =
          LogicUtils.isEmptyString(obj) || hSelf.highlightSelf
            ? "h-9 p-0 w-9 font-semibold font-fira-code text-center " +
              textColor$1 +
              "  dark:text-jp-gray-text_darktheme  " +
              dayClass
            : "h-9 p-0 w-9 font-semibold text-center font-fira-code " +
              textColor$1 +
              "  dark:text-jp-gray-text_darktheme hover:text-opacity-100 dark:hover:text-opacity-100 hover:bg-jp-gray-lightmode_steelgray hover:bg-opacity-75 hover:rounded-lg dark:hover:bg-jp-gray-850 dark:hover:bg-opacity-100 " +
              dayClass +
              " ";
        var c2 =
          LogicUtils.isNonEmptyString(obj) && hSelf.highlightSelf
            ? "h-full w-full flex flex-1 justify-center items-center bg-blue-500 bg-opacity-100 dark:bg-blue-500 dark:bg-opacity-100 text-white rounded-full"
            : "h-full w-full";
        var shouldHighlight = function (startDate, endDate, obj, month, year) {
          if (
            !(
              LogicUtils.isNonEmptyString(startDate) &&
              LogicUtils.isNonEmptyString(obj)
            )
          ) {
            return "h-full w-full";
          }
          var parsedStartDate = getDate(startDate.split("-"));
          var z = getDate([year, month, obj]);
          if (!LogicUtils.isNonEmptyString(endDate)) {
            if (Caml_obj.equal(z, parsedStartDate)) {
              return (
                "h-full w-full flex flex-1 justify-center items-center bg-blue-500 bg-opacity-100 dark:bg-blue-500 dark:bg-opacity-100 text-white rounded-lg " +
                changeHighlightCellStyle
              );
            } else if (
              LogicUtils.isNonEmptyString(hoverdDate) &&
              LogicUtils.isEmptyString(endDate) &&
              Caml_obj.greaterthan(z, parsedStartDate) &&
              Caml_obj.lessequal(z, new Date(hoverdDate)) &&
              !(
                (isFutureDate && disableFutureDates) ||
                (!isFutureDate && disablePastDates) ||
                (LogicUtils.isEmptyString(endDate) && !isInLimit)
              )
            ) {
              return "h-full w-full flex flex-1 justify-center items-center bg-blue-100 dark:bg-gray-700 dark:bg-opacity-100";
            } else {
              return "h-full w-full";
            }
          }
          var parsedEndDate = getDate(endDate.split("-"));
          if (Caml_obj.equal(z, parsedStartDate)) {
            return "h-full w-full flex flex-1 justify-center items-center bg-blue-500 bg-opacity-100 dark:bg-blue-500 dark:bg-opacity-100 text-white rounded-l-lg ";
          } else if (Caml_obj.equal(z, parsedEndDate)) {
            return "h-full w-full flex flex-1 justify-center items-center bg-blue-500 bg-opacity-100 dark:bg-blue-500 dark:bg-opacity-100 text-white rounded-r-lg ";
          } else if (
            Caml_obj.greaterthan(z, parsedStartDate) &&
            Caml_obj.lessthan(z, parsedEndDate)
          ) {
            return "h-full w-full flex flex-1 justify-center items-center bg-blue-100  dark:bg-gray-700 dark:bg-opacity-100 text-gray-600 dark:text-gray-400";
          } else {
            return "h-full w-full";
          }
        };
        var c3 = shouldHighlight(
          startDate,
          endDate,
          obj,
          (month + 1.0).toString(),
          year.toString(),
        );
        var handleHover = function () {
          var date$1 = Dayjs(date.toString()).format("YYYY-MM-DD");
          var parsedDate = getDate(date$1.split("-"));
          setHoverdDate(function (param) {
            return parsedDate.toString();
          });
          if (setShowMsg !== undefined) {
            if (
              LogicUtils.isNonEmptyString(hoverdDate) &&
              ((!isInLimit &&
                LogicUtils.isEmptyString(endDate) &&
                !isFutureDate &&
                disableFutureDates) ||
                (!disableFutureDates &&
                  !isInLimit &&
                  LogicUtils.isEmptyString(endDate)))
            ) {
              return setShowMsg(function (param) {
                return true;
              });
            } else {
              return setShowMsg(function (param) {
                return false;
              });
            }
          }
        };
        return React.createElement(
          "td",
          {
            key: cellIndex.toString(),
            className: classN,
            onClick: onClick,
            onMouseOut: function (_evt) {
              setHoverdDate(function (param) {
                return "";
              });
            },
            onMouseOver: function (param) {
              handleHover();
            },
          },
          React.createElement(AddDataAttributes.make, {
            attributes: [
              [
                "data-calender-date",
                hSelf.highlightSelf || LogicUtils.isNonEmptyString(startDate)
                  ? "selected"
                  : "normal",
              ],
              [
                "data-calender-date-disabled",
                (isFutureDate && disableFutureDates) ||
                (customDisabledFutureDays > 0.0 && isInCustomDisable) ||
                (!isFutureDate && disablePastDates) ||
                (LogicUtils.isEmptyString(endDate) && !isInLimit) ||
                dateNotInRange
                  ? "disabled"
                  : "enabled",
              ],
            ],
            children: React.createElement(
              "span",
              {
                className: LogicUtils.isEmptyString(startDate) ? c2 : c3,
              },
              cellRenderer(
                LogicUtils.isEmptyString(obj)
                  ? undefined
                  : Dayjs(date.toString()).format("YYYY-MM-DD"),
              ),
            ),
          }),
        );
      }),
    );
  }
}

var TableRow = {
  defaultCellHighlighter: defaultCellHighlighter,
  defaultCellRenderer: defaultCellRenderer,
  make: Calendar$TableRow,
};

function Calendar(props) {
  var allowedDateRange = props.allowedDateRange;
  var __customDisabledFutureDays = props.customDisabledFutureDays;
  var __showHead = props.showHead;
  var setShowMsg = props.setShowMsg;
  var dateRangeLimit = props.dateRangeLimit;
  var __disableFutureDates = props.disableFutureDates;
  var __disablePastDates = props.disablePastDates;
  var __endDate = props.endDate;
  var __startDate = props.startDate;
  var cellRenderer = props.cellRenderer;
  var cellHighlighter = props.cellHighlighter;
  var __showTitle = props.showTitle;
  var setHoverdDate = props.setHoverdDate;
  var hoverdDate = props.hoverdDate;
  var onDateClick = props.onDateClick;
  var year = props.year;
  var month = props.month;
  var __changeHighlightCellStyle = props.changeHighlightCellStyle;
  var changeHighlightCellStyle =
    __changeHighlightCellStyle !== undefined ? __changeHighlightCellStyle : "";
  var showTitle = __showTitle !== undefined ? __showTitle : true;
  var startDate = __startDate !== undefined ? __startDate : "";
  var endDate = __endDate !== undefined ? __endDate : "";
  var disablePastDates =
    __disablePastDates !== undefined ? __disablePastDates : true;
  var disableFutureDates =
    __disableFutureDates !== undefined ? __disableFutureDates : false;
  var showHead = __showHead !== undefined ? __showHead : true;
  var customDisabledFutureDays =
    __customDisabledFutureDays !== undefined ? __customDisabledFutureDays : 0.0;
  var months = [
    "Jan",
    "Feb",
    "Mar",
    "Apr",
    "May",
    "Jun",
    "Jul",
    "Aug",
    "Sep",
    "Oct",
    "Nov",
    "Dec",
  ];
  var heading = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
  var isMobileView = MatchMedia.useMobileChecker();
  var getMonthInStr = function (mon) {
    switch (mon) {
      case "Jan":
        return "January, ";
      case "Feb":
        return "February, ";
      case "Mar":
        return "March, ";
      case "Apr":
        return "April, ";
      case "May":
        return "May, ";
      case "Jun":
        return "June, ";
      case "Jul":
        return "July, ";
      case "Aug":
        return "August, ";
      case "Sep":
        return "September, ";
      case "Oct":
        return "October, ";
      case "Nov":
        return "November, ";
      case "Dec":
        return "December, ";
    }
  };
  var firstDay = new Date(year, months.indexOf(month)).getDay();
  var daysInMonth;
  switch (month) {
    case "Feb":
      daysInMonth = LogicUtils.checkLeapYear(year) ? 29 : 28;
      break;
    case "Apr":
    case "Jun":
    case "Sep":
    case "Nov":
      daysInMonth = 30;
      break;
    default:
      daysInMonth = 31;
  }
  var dummyRow = Core__Array.make(6, Core__Array.make(7, ""));
  var rowMapper = function (row, indexRow) {
    return row.map(function (_item, index) {
      var subFactor = firstDay | 0;
      if (indexRow === 0 && index < (firstDay | 0)) {
        return "";
      } else if (indexRow === 0) {
        return (
          (((indexRow + ((index + 1) | 0)) | 0) - subFactor) |
          0
        ).toString();
      } else if (
        ((((Math.imul(indexRow, 7) + ((index + 1) | 0)) | 0) - subFactor) | 0) >
        daysInMonth
      ) {
        return "";
      } else {
        return (
          (((Math.imul(indexRow, 7) + ((index + 1) | 0)) | 0) - subFactor) |
          0
        ).toString();
      }
    });
  };
  var rowInfo = dummyRow.map(rowMapper);
  return React.createElement(
    "div",
    {
      className: "text-sm px-2 pb-2",
    },
    showTitle
      ? React.createElement(
          "h3",
          {
            className: "text-center font-bold text-lg text-gray-500 ",
          },
          getMonthInStr(month),
          React.createElement(
            "span",
            {
              className: "font-fira-code",
            },
            year.toString(),
          ),
        )
      : React.createElement("span", undefined),
    React.createElement(
      "table",
      {
        className: "table-auto min-w-full",
      },
      React.createElement(
        "thead",
        undefined,
        showHead
          ? React.createElement(
              "tr",
              undefined,
              heading.map(function (item, i) {
                return React.createElement(
                  "th",
                  {
                    key: i.toString(),
                  },
                  React.createElement(
                    "div",
                    {
                      className:
                        "flex flex-1 justify-center py-1 text-jp-gray-700 dark:text-jp-gray-text_darktheme dark:text-opacity-50",
                    },
                    isMobileView ? item.charAt(0) : item,
                  ),
                );
              }),
            )
          : null,
      ),
      React.createElement(
        "tbody",
        undefined,
        rowInfo.map(function (item, rowIndex) {
          return JsxPPXReactSupportU.createElementWithKey(
            rowIndex.toString(),
            Calendar$TableRow,
            {
              changeHighlightCellStyle: changeHighlightCellStyle,
              item: item,
              month: months.indexOf(month),
              year: year,
              rowIndex: rowIndex,
              onDateClick: onDateClick,
              cellHighlighter: cellHighlighter,
              cellRenderer: cellRenderer,
              startDate: startDate,
              endDate: endDate,
              hoverdDate: hoverdDate,
              setHoverdDate: setHoverdDate,
              disablePastDates: disablePastDates,
              disableFutureDates: disableFutureDates,
              customDisabledFutureDays: customDisabledFutureDays,
              dateRangeLimit: dateRangeLimit,
              setShowMsg: setShowMsg,
              allowedDateRange: allowedDateRange,
            },
          );
        }),
      ),
    ),
  );
}

var make = Calendar;

export { TableRow, make };
/* dayjs Not a pure module */
