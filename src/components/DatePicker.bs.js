// Generated by ReScript, PLEASE EDIT WITH CARE

import Dayjs from "dayjs";
import * as React from "react";
import * as Button from "./Button.bs.js";
import * as Caml_obj from "rescript/lib/es6/caml_obj.js";
import * as TimeInput from "./TimeInput.bs.js";
import * as Core__JSON from "@rescript/core/src/Core__JSON.bs.js";
import * as LogicUtils from "../utils/LogicUtils.bs.js";
import * as MatchMedia from "../context/MatchMedia.bs.js";
import * as BottomModal from "./BottomModal.bs.js";
import * as Caml_option from "rescript/lib/es6/caml_option.js";
import * as CalendarList from "./CalendarList.bs.js";
import * as Core__Option from "@rescript/core/src/Core__Option.bs.js";
import * as OutsideClick from "../hooks/OutsideClick.bs.js";
import * as TimeZoneHook from "../hooks/TimeZoneHook.bs.js";
import * as DateRangePicker from "./DateRangePicker.bs.js";

function DatePicker(props) {
  var fullLength = props.fullLength;
  var __showSeconds = props.showSeconds;
  var __showTime = props.showTime;
  var __currentDateSecondsFormat = props.currentDateSecondsFormat;
  var __currentDateMinuteFormat = props.currentDateMinuteFormat;
  var __currentDateHourFormat = props.currentDateHourFormat;
  var __customDisabledFutureDays = props.customDisabledFutureDays;
  var rightIcon = props.rightIcon;
  var leftIcon = props.leftIcon;
  var __customButtonStyle = props.customButtonStyle;
  var __format = props.format;
  var __disableFutureDates = props.disableFutureDates;
  var __disablePastDates = props.disablePastDates;
  var __isDisabled = props.isDisabled;
  var input = props.input;
  var isDisabled = __isDisabled !== undefined ? __isDisabled : false;
  var disablePastDates =
    __disablePastDates !== undefined ? __disablePastDates : true;
  var disableFutureDates =
    __disableFutureDates !== undefined ? __disableFutureDates : false;
  var format = __format !== undefined ? __format : "YYYY-MM-DDTHH:mm:ss";
  var customButtonStyle =
    __customButtonStyle !== undefined ? __customButtonStyle : "";
  var customDisabledFutureDays =
    __customDisabledFutureDays !== undefined ? __customDisabledFutureDays : 0.0;
  var currentDateHourFormat =
    __currentDateHourFormat !== undefined ? __currentDateHourFormat : "00";
  var currentDateMinuteFormat =
    __currentDateMinuteFormat !== undefined ? __currentDateMinuteFormat : "00";
  var currentDateSecondsFormat =
    __currentDateSecondsFormat !== undefined
      ? __currentDateSecondsFormat
      : "00";
  var showTime = __showTime !== undefined ? __showTime : false;
  var showSeconds = __showSeconds !== undefined ? __showSeconds : true;
  var dropdownRef = React.useRef(null);
  var match = React.useState(function () {
    return false;
  });
  var setIsExpanded = match[1];
  var isExpanded = match[0];
  var customTimezoneToISOString = TimeZoneHook.useCustomTimeZoneToIsoString();
  var isoStringToCustomTimeZone = TimeZoneHook.useIsoStringToCustomTimeZone();
  var match$1 = React.useState(function () {
    return DateRangePicker.getDateStringForValue(
      LogicUtils.getStringFromJson(input.value, ""),
      isoStringToCustomTimeZone,
    );
  });
  var setSelectedDate = match$1[1];
  var selectedDate = match$1[0];
  var match$2 = React.useState(function () {
    if (!LogicUtils.isNonEmptyString(selectedDate)) {
      return "";
    }
    var date = selectedDate.split("-");
    var dateDay = Core__Option.getOr(date[2], "1");
    var dateMonth = Core__Option.getOr(date[1], "1");
    var dateYear = Core__Option.getOr(date[0], "1970");
    var str = Core__JSON.Decode.string(input.value);
    var timeSplit = DateRangePicker.getTimeStringForValue(
      str !== undefined ? str : "",
      isoStringToCustomTimeZone,
    ).split(":");
    var timeHour = Core__Option.getOr(timeSplit[0], currentDateHourFormat);
    var timeMinute = Core__Option.getOr(timeSplit[1], currentDateMinuteFormat);
    var timeSecond = Core__Option.getOr(timeSplit[2], currentDateSecondsFormat);
    var dateTimeCheck = customTimezoneToISOString(
      dateYear,
      dateMonth,
      dateDay,
      timeHour,
      timeMinute,
      timeSecond,
    );
    return TimeZoneHook.formattedISOString(dateTimeCheck, format);
  });
  var setDate = match$2[1];
  var date = match$2[0];
  var dropdownVisibilityClass = isExpanded ? "inline-block z-100" : "hidden";
  var onDateClick = function (str) {
    if (showTime) {
    } else {
      setIsExpanded(function (p) {
        return !p;
      });
    }
    setSelectedDate(function (param) {
      return str;
    });
    var currentDateSplit = str.split("-");
    var currentDateDay = Core__Option.getOr(currentDateSplit[2], "1");
    var currentDateYear = Core__Option.getOr(currentDateSplit[0], "1970");
    var currentDateMonth = Core__Option.getOr(currentDateSplit[1], "1");
    var currentDateTimeCheck = customTimezoneToISOString(
      currentDateYear,
      currentDateMonth,
      currentDateDay,
      currentDateHourFormat,
      currentDateMinuteFormat,
      currentDateSecondsFormat,
    );
    setDate(function (param) {
      return currentDateTimeCheck;
    });
    input.onChange(currentDateTimeCheck);
  };
  React.useEffect(
    function () {
      if (Caml_obj.equal(input.value, "")) {
        setSelectedDate(function (param) {
          return "";
        });
      }
    },
    [input.value],
  );
  var defaultCellHighlighter = function (currDate) {
    return {
      highlightSelf: currDate === selectedDate,
      highlightLeft: false,
      highlightRight: false,
    };
  };
  OutsideClick.useOutsideClick(
    {
      TAG: "ArrayOfRef",
      _0: [dropdownRef],
    },
    undefined,
    isExpanded,
    undefined,
    function () {
      setIsExpanded(function (p) {
        return !p;
      });
    },
    undefined,
  );
  var changeVisibility = function (_ev) {
    if (!isDisabled) {
      return setIsExpanded(function (p) {
        return !p;
      });
    }
  };
  var startDateStr;
  if (LogicUtils.isEmptyString(selectedDate)) {
    startDateStr = "Select Date";
  } else if (showTime) {
    var time = DateRangePicker.getTimeStringForValue(
      date,
      isoStringToCustomTimeZone,
    );
    var splitTime = time.split(":");
    startDateStr =
      selectedDate +
      " " +
      (LogicUtils.isEmptyString(time)
        ? currentDateHourFormat +
          ":" +
          currentDateMinuteFormat +
          (showSeconds ? ":" + currentDateSecondsFormat : "")
        : Core__Option.getOr(splitTime[0], "NA") +
          ":" +
          Core__Option.getOr(splitTime[1], "NA") +
          (showSeconds ? ":" + Core__Option.getOr(splitTime[2], "NA") : ""));
  } else {
    startDateStr = selectedDate;
  }
  var buttonIcon = isExpanded ? "angle-up" : "angle-down";
  var rightIcon$1 =
    rightIcon !== undefined
      ? rightIcon
      : {
          TAG: "FontAwesome",
          _0: buttonIcon,
        };
  var leftIcon$1 =
    leftIcon !== undefined
      ? leftIcon
      : {
          TAG: "FontAwesome",
          _0: "calendar",
        };
  var fullLengthWidthClass = Core__Option.getOr(fullLength, false)
    ? "2xl:w-full"
    : "";
  var time$1 = DateRangePicker.getTimeStringForValue(
    date,
    isoStringToCustomTimeZone,
  );
  var startTimeInput_onBlur = function (_ev) {};
  var startTimeInput_onChange = function (timeValEv) {
    if (!LogicUtils.isNonEmptyString(selectedDate)) {
      return;
    }
    var todayDayJsObj = Dayjs(new Date().toString());
    var todayTime = todayDayJsObj.format("HH:mm:ss");
    var todayDate = todayDayJsObj.format("YYYY-MM-DD");
    var timeVal =
      disableFutureDates && selectedDate === todayDate && timeValEv > todayTime
        ? todayTime
        : timeValEv;
    var date = selectedDate.split("-");
    var dateDay = Core__Option.getOr(date[2], "1");
    var dateMonth = Core__Option.getOr(date[1], "1");
    var dateYear = Core__Option.getOr(date[0], "1970");
    var timeSplit = timeVal.split(":");
    var timeHour = Core__Option.getOr(timeSplit[0], currentDateHourFormat);
    var timeMinute = Core__Option.getOr(timeSplit[1], currentDateMinuteFormat);
    var timeSecond = Core__Option.getOr(timeSplit[2], currentDateSecondsFormat);
    var dateTimeCheck = customTimezoneToISOString(
      dateYear,
      dateMonth,
      dateDay,
      timeHour,
      timeMinute,
      timeSecond,
    );
    var timestamp = TimeZoneHook.formattedISOString(dateTimeCheck, format);
    setDate(function (param) {
      return timestamp;
    });
    input.onChange(LogicUtils.dateFormat(timestamp, format));
  };
  var startTimeInput_onFocus = function (_ev) {};
  var startTimeInput_value = LogicUtils.isEmptyString(time$1)
    ? currentDateHourFormat +
      ":" +
      currentDateMinuteFormat +
      ":" +
      currentDateSecondsFormat
    : time$1;
  var startTimeInput = {
    name: "string",
    onBlur: startTimeInput_onBlur,
    onChange: startTimeInput_onChange,
    onFocus: startTimeInput_onFocus,
    value: startTimeInput_value,
    checked: false,
  };
  var styleClass = showTime
    ? " flex-col bg-white dark:bg-jp-gray-lightgray_background border-jp-gray-500 dark:border-jp-gray-960 p-4 rounded border"
    : "flex-row";
  var isMobileView = MatchMedia.useMobileChecker();
  var calendarElement = React.createElement(
    React.Fragment,
    {},
    React.createElement(CalendarList.make, {
      calendarContaierStyle: props.calendarContaierStyle,
      onDateClick: onDateClick,
      count: 1,
      cellHighlighter: defaultCellHighlighter,
      disablePastDates: disablePastDates,
      disableFutureDates: disableFutureDates,
      customDisabledFutureDays: customDisabledFutureDays,
    }),
    showTime
      ? React.createElement(
          "div",
          {
            className: "w-fit dark:text-gray-400 text-gray-700 ",
          },
          React.createElement(TimeInput.make, {
            input: startTimeInput,
            isDisabled: LogicUtils.isEmptyString(selectedDate),
            showSeconds: showSeconds,
          }),
        )
      : null,
  );
  return React.createElement(
    "div",
    {
      ref: Caml_option.some(dropdownRef),
      className: "md:relative",
    },
    React.createElement(Button.make, {
      buttonState: isDisabled ? "Disabled" : "Normal",
      text: startDateStr,
      buttonType: props.buttonType,
      buttonSize: props.buttonSize,
      leftIcon: leftIcon$1,
      rightIcon: rightIcon$1,
      onClick: changeVisibility,
      fullLength: fullLength,
      customButtonStyle: customButtonStyle,
    }),
    React.createElement(
      "div",
      {
        className: dropdownVisibilityClass,
      },
      isMobileView
        ? React.createElement(BottomModal.make, {
            onCloseClick: changeVisibility,
            children: calendarElement,
            headerText: startDateStr,
          })
        : React.createElement(
            "div",
            {
              className:
                "absolute flex w-max z-10  " +
                fullLengthWidthClass +
                " " +
                styleClass,
            },
            calendarElement,
          ),
    ),
  );
}

var make = DatePicker;

export { make };
/* dayjs Not a pure module */
