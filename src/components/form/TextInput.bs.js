// Generated by ReScript, PLEASE EDIT WITH CARE

import * as Icon from "../Icon.bs.js";
import * as React from "react";
import * as ToolTip from "../tooltip/ToolTip.bs.js";
import * as Caml_obj from "rescript/lib/es6/caml_obj.js";
import * as Core__JSON from "@rescript/core/src/Core__JSON.bs.js";
import * as LogicUtils from "../../utils/LogicUtils.bs.js";
import * as PopUpState from "../../hooks/PopUpState.bs.js";
import * as Caml_option from "rescript/lib/es6/caml_option.js";
import * as Core__Option from "@rescript/core/src/Core__Option.bs.js";
import * as ThemeProvider from "../../context/ThemeProvider.bs.js";
import * as ReactFinalForm from "react-final-form";
import * as AddDataAttributes from "../AddDataAttributes.bs.js";
import * as ButtonGroupContext from "../../context/ButtonGroupContext.bs.js";

function TextInput(props) {
  var __removeValidationCheck = props.removeValidationCheck;
  var __phoneInput = props.phoneInput;
  var __customDarkBackground = props.customDarkBackground;
  var __onActiveStyle = props.onActiveStyle;
  var __onDisabledStyle = props.onDisabledStyle;
  var __onHoverCss = props.onHoverCss;
  var __leftIconCustomStyle = props.leftIconCustomStyle;
  var __rightIconCustomStyle = props.rightIconCustomStyle;
  var __widthMatchwithPlaceholderLength = props.widthMatchwithPlaceholderLength;
  var __customPaddingClass = props.customPaddingClass;
  var __iconOpacity = props.iconOpacity;
  var readOnly = props.readOnly;
  var __customWidth = props.customWidth;
  var __customStyle = props.customStyle;
  var onKeyUp = props.onKeyUp;
  var __inputStyle = props.inputStyle;
  var rightIconOnClick = props.rightIconOnClick;
  var rightIcon = props.rightIcon;
  var leftIcon = props.leftIcon;
  var __autoFocus = props.autoFocus;
  var maxLength = props.maxLength;
  var max = props.max;
  var min = props.min;
  var __shouldSubmitForm = props.shouldSubmitForm;
  var autoComplete = props.autoComplete;
  var pattern = props.pattern;
  var __inputMode = props.inputMode;
  var __type_ = props.type_;
  var __isDisabled = props.isDisabled;
  var __description = props.description;
  var placeholder = props.placeholder;
  var input = props.input;
  var focusOnKeyPress = props.focusOnKeyPress;
  var description = __description !== undefined ? __description : "";
  var isDisabled = __isDisabled !== undefined ? __isDisabled : false;
  var type_ = __type_ !== undefined ? __type_ : "text";
  var inputMode = __inputMode !== undefined ? __inputMode : "text";
  var shouldSubmitForm =
    __shouldSubmitForm !== undefined ? __shouldSubmitForm : true;
  var autoFocus = __autoFocus !== undefined ? __autoFocus : false;
  var inputStyle = __inputStyle !== undefined ? __inputStyle : "";
  var customStyle = __customStyle !== undefined ? __customStyle : "";
  var customWidth = __customWidth !== undefined ? __customWidth : "w-full";
  var iconOpacity = __iconOpacity !== undefined ? __iconOpacity : "opacity-30";
  var customPaddingClass =
    __customPaddingClass !== undefined ? __customPaddingClass : "";
  var widthMatchwithPlaceholderLength =
    __widthMatchwithPlaceholderLength !== undefined
      ? Caml_option.valFromOption(__widthMatchwithPlaceholderLength)
      : undefined;
  var rightIconCustomStyle =
    __rightIconCustomStyle !== undefined ? __rightIconCustomStyle : "";
  var leftIconCustomStyle =
    __leftIconCustomStyle !== undefined ? __leftIconCustomStyle : "";
  var onHoverCss = __onHoverCss !== undefined ? __onHoverCss : "";
  var onDisabledStyle =
    __onDisabledStyle !== undefined ? __onDisabledStyle : "";
  var onActiveStyle = __onActiveStyle !== undefined ? __onActiveStyle : "";
  var customDarkBackground =
    __customDarkBackground !== undefined
      ? __customDarkBackground
      : "dark:bg-jp-gray-darkgray_background";
  var phoneInput = __phoneInput !== undefined ? __phoneInput : false;
  var removeValidationCheck =
    __removeValidationCheck !== undefined ? __removeValidationCheck : false;
  var match = React.useContext(ThemeProvider.themeContext);
  var match$1 = match.globalUIConfig;
  var borderColor = match$1.border.borderColor;
  var showPopUp = PopUpState.useShowPopUp();
  var isInValid;
  try {
    var match$2 = ReactFinalForm.useField(input.name);
    if (removeValidationCheck) {
      isInValid = false;
    } else {
      var meta = match$2.meta;
      isInValid =
        !meta.valid && meta.touched
          ? (!(meta.submitError == null) && !meta.dirtySinceLastSubmit) ||
            !(meta.error == null)
          : false;
    }
  } catch (exn) {
    isInValid = false;
  }
  var match$3 = React.useContext(ButtonGroupContext.buttonGroupContext);
  var isLast = match$3.isLast;
  var isFirst = match$3.isFirst;
  var match$4 = React.useState(function () {
    return false;
  });
  var setShowPassword = match$4[1];
  var showPassword = match$4[0];
  var inputRef = React.useRef(null);
  React.useEffect(
    function () {
      if (widthMatchwithPlaceholderLength !== undefined) {
        var elem = inputRef.current;
        if (!(elem == null)) {
          var size = Core__Option.mapOr(
            Caml_option.nullable_to_opt(elem.getAttribute("placeholder")),
            widthMatchwithPlaceholderLength,
            function (str) {
              return Math.max(widthMatchwithPlaceholderLength, str.length);
            },
          ).toString();
          elem.setAttribute("size", size);
        }
      }
    },
    [inputRef.current, input.name],
  );
  React.useEffect(
    function () {
      var val = Core__Option.getOr(Core__JSON.Decode.string(input.value), "");
      if (val.includes("<script>") || val.includes("</script>")) {
        showPopUp({
          heading: "Script Tags are not allowed",
          description: "Input cannot contain <script>, </script> tags",
          popUpType: ["Warning", "WithIcon"],
          handleConfirm: {
            text: "OK",
          },
        });
        input.onChange(val.replace("<script>", "").replace("</script>", ""));
      }
    },
    [input.value],
  );
  React.useEffect(
    function () {
      if (focusOnKeyPress === undefined) {
        return;
      }
      var keyDownFn = function (ev) {
        if (!focusOnKeyPress(ev)) {
          return;
        }
        ev.preventDefault();
        var elem = inputRef.current;
        if (!(elem == null)) {
          elem.focus();
          return;
        }
      };
      window.addEventListener("keydown", keyDownFn);
      return function () {
        window.removeEventListener("keydown", keyDownFn);
      };
    },
    [focusOnKeyPress],
  );
  var cursorClass = isDisabled ? "cursor-not-allowed" : "";
  var roundingClass =
    isFirst && isLast
      ? "rounded"
      : isFirst
        ? "rounded-l"
        : isLast
          ? "rounded-r"
          : "";
  var borderClass = isInValid
    ? "border-red-500 focus:border-red-500  dark:border-red-500 dark:hover:border-red-500 dark:focus:border-red-500 focus:shadow-text_input_shadow focus:shadow-red-500"
    : "border-jp-gray-lightmode_steelgray " +
      borderColor.primaryFocused +
      " dark:border-jp-gray-960 dark:hover:border-jp-gray-960 dark:" +
      borderColor.primaryFocused +
      " focus:shadow-text_input_shadow " +
      match$1.shadow.shadowColor.primaryFocused;
  var dashboardClass = Core__Option.getOr(
    props.customDashboardClass,
    "h-10 text-sm font-normal",
  );
  var rightPaddingClass =
    LogicUtils.isNonEmptyString(description) ||
    isInValid ||
    rightIcon !== undefined
      ? "pr-10"
      : "pr-2";
  var leftPaddingClass = leftIcon !== undefined ? "pl-10" : "pl-2";
  var textAndBgClass =
    customDarkBackground +
    " text-jp-gray-900 text-opacity-75 focus:text-opacity-100 dark:text-jp-gray-text_darktheme dark:text-opacity-75 dark:placeholder-jp-gray-text_darktheme dark:placeholder-opacity-25 dark:focus:text-opacity-100";
  var width = Core__Option.isSome(widthMatchwithPlaceholderLength)
    ? ""
    : customWidth;
  var textPaddingClass =
    type_ !== "range" && LogicUtils.isEmptyString(customPaddingClass)
      ? rightPaddingClass + " " + leftPaddingClass + " "
      : customPaddingClass;
  var hoverCss = LogicUtils.isEmptyString(onHoverCss)
    ? "hover:bg-jp-gray-lightmode_steelgray hover:bg-opacity-20 hover:border-opacity-20 dark:hover:bg-jp-gray-970"
    : onHoverCss;
  var className =
    width +
    " border border-opacity-75 " +
    textPaddingClass +
    " " +
    textAndBgClass +
    " placeholder-jp-gray-900 placeholder-opacity-25 focus:outline-none\n      focus:border-opacity-100 " +
    hoverCss +
    " " +
    roundingClass +
    " " +
    cursorClass +
    " " +
    dashboardClass +
    " " +
    inputStyle +
    " " +
    borderClass +
    " " +
    customStyle +
    " placeholder-opacity-50 " +
    (isDisabled ? onDisabledStyle : onActiveStyle);
  var str = Core__JSON.Classify.classify(input.value);
  var value;
  if (typeof str !== "object") {
    value = "";
  } else {
    switch (str.TAG) {
      case "String":
        value = str._0;
        break;
      case "Number":
        value = str._0.toString();
        break;
      default:
        value = "";
    }
  }
  var passwordVisiblity = function (param) {
    setShowPassword(function (prev) {
      return !prev;
    });
  };
  var leftIconClass =
    "absolute self-center p-3 " + iconOpacity + " " + leftIconCustomStyle;
  var leftIconElement =
    leftIcon !== undefined
      ? React.createElement(
          "div",
          {
            className: leftIconClass,
            id: "leftIcon",
          },
          Caml_option.valFromOption(leftIcon),
        )
      : null;
  var rightIconCursorClass =
    rightIconOnClick !== undefined ? "cursor-pointer" : "";
  var rightIconStyle = LogicUtils.isEmptyString(rightIconCustomStyle)
    ? "-ml-10 " + rightIconCursorClass
    : rightIconCustomStyle;
  var rightIconClick = function (ev) {
    if (rightIconOnClick !== undefined) {
      return rightIconOnClick(ev);
    }
  };
  var rightIconElement =
    rightIcon !== undefined
      ? React.createElement(
          "div",
          {
            className: rightIconStyle,
            id: "rightIcon",
            onClick: rightIconClick,
          },
          Caml_option.valFromOption(rightIcon),
        )
      : null;
  var inputName = autoComplete === "off" ? undefined : input.name;
  var form = shouldSubmitForm ? undefined : "fakeForm";
  var className$1;
  if (Caml_obj.notequal(rightIconElement, null)) {
    className$1 = className + " pr-10";
  } else if (Caml_obj.notequal(leftIconElement, null)) {
    var padding = phoneInput ? "pl-20" : "pl-10";
    className$1 = className + " " + padding;
  } else {
    className$1 = className;
  }
  var eyeIcon = showPassword ? "eye" : "eye-slash";
  if (type_ === "password" || type_ === "password_without_icon") {
    return React.createElement(AddDataAttributes.make, {
      attributes: [
        ["data-id-password", input.name],
        ["data-input-name", input.name],
        ["data-testid", input.name],
      ],
      children: React.createElement(
        "div",
        {
          className: "flex flex-row items-center relative",
        },
        leftIconElement,
        React.createElement("input", {
          ref: Caml_option.some(inputRef),
          className: className$1 + " pr-10",
          autoComplete: autoComplete,
          disabled: isDisabled,
          form: form,
          inputMode: inputMode,
          max: max,
          maxLength: maxLength,
          min: min,
          name: inputName,
          pattern: pattern,
          placeholder: placeholder,
          readOnly: readOnly,
          type: showPassword ? "text" : "password",
          value: value,
          onKeyUp: onKeyUp,
          onFocus: input.onFocus,
          onBlur: input.onBlur,
          onChange: input.onChange,
        }),
        type_ !== "password_without_icon"
          ? React.createElement(
              "div",
              {
                className: "cursor-pointer select-none -ml-8",
                onClick: passwordVisiblity,
              },
              React.createElement(Icon.make, {
                name: eyeIcon,
                size: 15,
                className: "fill-jp-gray-700",
              }),
            )
          : null,
      ),
    });
  } else {
    return React.createElement(AddDataAttributes.make, {
      attributes: [
        ["data-id", placeholder],
        ["data-input-name", input.name],
        ["data-testid", input.name],
      ],
      children: React.createElement(
        "div",
        {
          className: "flex flex-row relative items-center grow",
        },
        leftIconElement,
        React.createElement("input", {
          ref: Caml_option.some(inputRef),
          className: className$1,
          autoComplete: autoComplete,
          autoFocus: autoFocus,
          disabled: isDisabled,
          form: form,
          inputMode: inputMode,
          max: max,
          maxLength: maxLength,
          min: min,
          name: inputName,
          pattern: pattern,
          placeholder: placeholder,
          readOnly: readOnly,
          type: type_,
          value: value,
          onKeyUp: onKeyUp,
          onFocus: input.onFocus,
          onBlur: input.onBlur,
          onChange: input.onChange,
        }),
        LogicUtils.isNonEmptyString(description)
          ? React.createElement(ToolTip.make, {
              description: description,
              toolTipFor: Caml_option.some(
                React.createElement(
                  "div",
                  {
                    className: "cursor-pointer select-none -ml-8",
                  },
                  React.createElement(Icon.make, {
                    name: "new-question-circle",
                    size: 16,
                    className: "stroke-jp-2-light-gray-1000",
                  }),
                ),
              ),
              toolTipPosition: "Right",
              height: "h-min",
            })
          : rightIconElement,
      ),
    });
  }
}

var make = TextInput;

export { make };
/* Icon Not a pure module */
