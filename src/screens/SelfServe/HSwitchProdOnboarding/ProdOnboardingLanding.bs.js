// Generated by ReScript, PLEASE EDIT WITH CARE

import * as Icon from "../../../components/Icon.bs.js";
import * as React from "react";
import * as APIUtils from "../../APIUtils/APIUtils.bs.js";
import * as RenderIf from "../../../utils/RenderIf.bs.js";
import * as HomeUtils from "../../Home/HomeUtils.bs.js";
import * as Core__List from "@rescript/core/src/Core__List.bs.js";
import * as GlobalVars from "../../../utils/GlobalVars.bs.js";
import * as LogicUtils from "../../../utils/LogicUtils.bs.js";
import * as Caml_option from "rescript/lib/es6/caml_option.js";
import * as Core__Option from "@rescript/core/src/Core__Option.bs.js";
import * as ThemeProvider from "../../../context/ThemeProvider.bs.js";
import * as GlobalProvider from "../../../entryPoints/Provider/GlobalProvider.bs.js";
import * as SwitchMerchant from "../../SwitchMerchant/SwitchMerchant.bs.js";
import * as ChooseConnector from "./ChooseConnector.bs.js";
import * as CommonAuthHooks from "../../../entryPoints/AuthModule/Common/CommonAuthHooks.bs.js";
import * as ConnectorPreview from "../../Connectors/ConnectorPreview.bs.js";
import * as PageLoaderWrapper from "../../Helpers/PageLoaderWrapper.bs.js";
import * as LiveEndpointsSetup from "./LiveEndpointsSetup.bs.js";
import * as ProdOnboardingUtils from "./ProdOnboardingUtils.bs.js";
import * as RescriptReactRouter from "@rescript/react/src/RescriptReactRouter.bs.js";
import * as ProdOnboardingUIUtils from "./ProdOnboardingUIUtils.bs.js";
import * as SetupConnectorCredentials from "./SetupConnectorCredentials.bs.js";

var unselectedNormalText = "text-base font-normal text-grey-700 opacity-50";

var selectedNormalText = "text-base font-medium text-grey-700 ";

var dividerColor = "bg-grey-700 bg-opacity-20 h-px w-full";

var unselectedSubHeading = "text-lg font-normal text-grey-700 ";

function ProdOnboardingLanding$CheckListSection(props) {
  var setPreviewState = props.setPreviewState;
  var getConnectorDetails = props.getConnectorDetails;
  var pageView = props.pageView;
  var headerVariant = props.headerVariant;
  var checkListItems = props.checkListItems;
  var match = React.useContext(ThemeProvider.themeContext);
  var match$1 = match.globalUIConfig;
  var backgroundColor = match$1.backgroundColor;
  var stepColor = checkListItems.includes(pageView)
    ? backgroundColor + " text-white py-px px-2 rounded-md"
    : backgroundColor +
      " bg-opacity-20  " +
      match$1.font.textColor.primaryNormal +
      " py-px px-2 rounded-md";
  var bgColor = checkListItems.includes(pageView)
    ? "bg-white"
    : "bg-jp-gray-light_gray_bg";
  var selectedItemColor = function (indexVal) {
    if (
      ProdOnboardingUtils.getIndexFromVariant(indexVal) ===
      ProdOnboardingUtils.getIndexFromVariant(pageView)
    ) {
      return "bg-pdf_background rounded-md";
    } else {
      return "";
    }
  };
  return React.createElement(
    "div",
    {
      className: "flex flex-col py-8 px-6 gap-3 " + bgColor + " cursor-pointer",
      onClick: function (param) {
        var currentViewindex = ProdOnboardingUtils.updatedCheckList.indexOf(
          Core__Option.getOr(
            ProdOnboardingUtils.updatedCheckList.filter(function (ele) {
              return ele.itemsVariants.includes(pageView);
            })[0],
            ProdOnboardingUtils.defaultValueOfCheckList,
          ),
        );
        if (currentViewindex !== 1) {
          if (currentViewindex === 2) {
            if (headerVariant === "SetupProcessor") {
              getConnectorDetails(headerVariant);
              return;
            }
            if (headerVariant === "ConfigureEndpoint") {
              return setPreviewState(function (param) {
                return ProdOnboardingUtils.getPreviewState("ConfigureEndpoint");
              });
            }
          }
        } else if (headerVariant === "SetupProcessor") {
          getConnectorDetails(headerVariant);
          return;
        }
        setPreviewState(function (param) {});
      },
    },
    React.createElement(
      "div",
      {
        className: "flex justify-between ",
      },
      React.createElement(
        "div",
        {
          className: "flex gap-4",
        },
        React.createElement(
          "p",
          {
            className: stepColor + " font-bold",
          },
          ((props.sectionIndex + 1) | 0).toString(),
        ),
        React.createElement(
          "p",
          {
            className: unselectedSubHeading,
          },
          props.headerText,
        ),
      ),
      React.createElement(RenderIf.make, {
        condition: !checkListItems.includes(pageView),
        children: React.createElement(Icon.make, {
          name: "lock-outlined",
          size: 20,
        }),
      }),
    ),
    checkListItems.map(function (value, index) {
      return React.createElement(
        "div",
        {
          key: index.toString(),
          className:
            "flex pl-10 gap-2 py-2 cursor-pointer " + selectedItemColor(value),
        },
        React.createElement(Icon.make, {
          name:
            ProdOnboardingUtils.getIndexFromVariant(value) <
            ProdOnboardingUtils.getIndexFromVariant(pageView)
              ? "green-check"
              : "nonselected",
          size: 20,
        }),
        React.createElement(
          "p",
          {
            key: index.toString(),
            className:
              (ProdOnboardingUtils.getIndexFromVariant(value) ===
              ProdOnboardingUtils.getIndexFromVariant(pageView)
                ? selectedNormalText
                : unselectedNormalText) + "  ",
          },
          ProdOnboardingUtils.sidebarTextFromVariant(value),
        ),
      );
    }),
  );
}

var CheckListSection = {
  make: ProdOnboardingLanding$CheckListSection,
};

function ProdOnboardingLanding$ProgressBar(props) {
  var match = React.useContext(ThemeProvider.themeContext);
  var backgroundColor = match.globalUIConfig.backgroundColor;
  return React.createElement(
    "div",
    {
      className: backgroundColor + " bg-opacity-20 h-1.5 w-full",
    },
    React.createElement("div", {
      className: "h-full " + backgroundColor,
      style: {
        width: props.progressState + "%",
      },
    }),
  );
}

var ProgressBar = {
  make: ProdOnboardingLanding$ProgressBar,
};

function ProdOnboardingLanding$SidebarChecklist(props) {
  var setPreviewState = props.setPreviewState;
  var getConnectorDetails = props.getConnectorDetails;
  var pageView = props.pageView;
  var match = React.useState(function () {
    return 0;
  });
  var setProgressState = match[1];
  var progressState = match[0];
  React.useEffect(
    function () {
      var currentIndex = ProdOnboardingUtils.getIndexFromVariant(pageView);
      var progress = (2 + (currentIndex << 4)) | 0;
      setProgressState(function (param) {
        return progress;
      });
    },
    [pageView],
  );
  var getProgressText =
    progressState !== 2
      ? progressState.toString() + "% completed"
      : "0% completed";
  return React.createElement(
    "div",
    {
      className: "flex flex-col h-full w-[30rem] border bg-white shadow",
    },
    React.createElement(
      "p",
      {
        className: "font-semibold text-xl p-6",
      },
      "Setup Basic Live Account",
    ),
    React.createElement("div", {
      className: dividerColor,
    }),
    React.createElement(
      "div",
      {
        className: "flex flex-col gap-4 px-6 py-8",
      },
      React.createElement(
        "p",
        {
          className: " text-grey-700 text-base font-normal",
        },
        getProgressText,
      ),
      React.createElement(ProdOnboardingLanding$ProgressBar, {
        progressState: progressState.toString(),
      }),
    ),
    React.createElement("div", {
      className: dividerColor,
    }),
    ProdOnboardingUtils.updatedCheckList.map(function (items, sectionIndex) {
      return React.createElement(
        "div",
        {
          key: sectionIndex.toString(),
        },
        React.createElement(ProdOnboardingLanding$CheckListSection, {
          headerText: items.headerText,
          checkListItems: items.itemsVariants,
          headerVariant: items.headerVariant,
          sectionIndex: sectionIndex,
          pageView: pageView,
          getConnectorDetails: getConnectorDetails,
          setPreviewState: setPreviewState,
        }),
        React.createElement("div", {
          className: dividerColor,
        }),
      );
    }),
  );
}

var SidebarChecklist = {
  make: ProdOnboardingLanding$SidebarChecklist,
};

function ProdOnboardingLanding(props) {
  var getURL = APIUtils.useGetURL();
  var fetchDetails = APIUtils.useGetMethod(undefined, undefined);
  var match = React.useState(function () {
    return "SELECT_PROCESSOR";
  });
  var setPageView = match[1];
  var pageView = match[0];
  var match$1 = React.useState(function () {
    return {
      TAG: "Processors",
      _0: "STRIPE",
    };
  });
  var selectedConnector = match$1[0];
  React.useState(function () {
    return "";
  });
  var updateDetails = APIUtils.useUpdateMethod(undefined, undefined);
  var match$2 = React.useContext(GlobalProvider.defaultContext);
  var setDashboardPageState = match$2.setDashboardPageState;
  var match$3 = React.useState(function () {
    return "Loading";
  });
  var setScreenState = match$3[1];
  var match$4 = React.useState(function () {
    return "Normal";
  });
  var setButtonState = match$4[1];
  var match$5 = React.useState(function () {});
  var setPreviewState = match$5[1];
  var previewState = match$5[0];
  var match$6 = React.useState(function () {
    return {};
  });
  var setInitialValues = match$6[1];
  var match$7 = React.useState(function () {
    return "";
  });
  var setConnectorID = match$7[1];
  var connectorID = match$7[0];
  var routerUrl = RescriptReactRouter.useUrl(undefined, undefined);
  var centerItems = pageView === "SETUP_COMPLETED" ? "justify-center" : "";
  var urlPush = GlobalVars.appendDashboardPath(
    "/prod-onboarding?" + routerUrl.search,
  );
  var match$8 = Core__Option.getOr(
    CommonAuthHooks.useCommonAuthInfo(),
    CommonAuthHooks.defaultAuthInfo,
  );
  var getSetupCompleteEnum = function (prodEnums) {
    if (prodEnums.setupComplete) {
      setDashboardPageState(function (param) {
        return "HOME";
      });
      var baseUrlPath =
        GlobalVars.getHostUrl +
        "/" +
        Core__List.toArray(routerUrl.path).join("/");
      if (LogicUtils.isNonEmptyString(routerUrl.search)) {
        return RescriptReactRouter.push(baseUrlPath + "?" + routerUrl.search);
      } else {
        return RescriptReactRouter.push(baseUrlPath);
      }
    }
    RescriptReactRouter.push(urlPush);
    setPageView(function (param) {
      return "SETUP_COMPLETED";
    });
    setScreenState(function (param) {
      return "Success";
    });
  };
  var getConfigureEndpointEnum = function (prodEnums) {
    if (prodEnums.configureEndpoint) {
      getSetupCompleteEnum(prodEnums);
      return;
    } else {
      RescriptReactRouter.push(urlPush);
      setPageView(function (param) {
        return "REPLACE_API_KEYS";
      });
      return setScreenState(function (param) {
        return "Success";
      });
    }
  };
  var getConnectorDetails = async function (headerVariant) {
    try {
      var connectorUrl = getURL(
        "CONNECTOR",
        "Get",
        Caml_option.some(connectorID),
        undefined,
        undefined,
        undefined,
        undefined,
        undefined,
        undefined,
      );
      var json = await fetchDetails(connectorUrl);
      var connectorName = LogicUtils.getString(
        LogicUtils.getDictFromJsonObject(json),
        "connector_name",
        "",
      );
      setInitialValues(function (param) {
        return json;
      });
      setPreviewState(function (param) {
        return ProdOnboardingUtils.getPreviewState(headerVariant);
      });
      return RescriptReactRouter.replace(
        GlobalVars.appendDashboardPath(
          "/prod-onboarding?name=" + connectorName,
        ),
      );
    } catch (exn) {
      return setScreenState(function (param) {
        return {
          TAG: "Error",
          _0: "",
        };
      });
    }
  };
  var getStatus = async function () {
    try {
      var url = getURL(
        "USERS",
        "Get",
        undefined,
        undefined,
        "USER_DATA",
        undefined,
        undefined,
        Caml_option.some(
          "keys=" + ProdOnboardingUtils.prodOnboardingEnumIntialArray.join(","),
        ),
        undefined,
      );
      var response = await fetchDetails(url);
      var prodEnums = ProdOnboardingUtils.getTypedValue(
        HomeUtils.responseDataMapper(response, HomeUtils.getValueMappedForProd),
      );
      var connectorId = prodEnums.setupProcessor.connector_id;
      if (LogicUtils.isNonEmptyString(connectorId)) {
        setConnectorID(function (param) {
          return connectorId;
        });
        getConfigureEndpointEnum(prodEnums);
        return;
      } else {
        RescriptReactRouter.push(urlPush);
        setPageView(function (param) {
          return "SELECT_PROCESSOR";
        });
        return setScreenState(function (param) {
          return "Success";
        });
      }
    } catch (exn) {
      return setScreenState(function (param) {
        return {
          TAG: "Error",
          _0: "",
        };
      });
    }
  };
  var updateSetupPageCompleted = async function () {
    try {
      setButtonState(function (param) {
        return "Loading";
      });
      var url = getURL(
        "USERS",
        "Post",
        undefined,
        undefined,
        "MERCHANT_DATA",
        undefined,
        undefined,
        undefined,
        undefined,
      );
      var body = ProdOnboardingUtils.getProdApiBody(
        "SetupComplete",
        undefined,
        undefined,
        undefined,
      );
      await updateDetails(
        url,
        body,
        "Post",
        undefined,
        undefined,
        undefined,
        undefined,
      );
      setButtonState(function (param) {
        return "Normal";
      });
      return setDashboardPageState(function (param) {
        return "HOME";
      });
    } catch (exn) {
      return setButtonState(function (param) {
        return "Normal";
      });
    }
  };
  React.useEffect(function () {
    getStatus();
  }, []);
  var tmp;
  if (previewState !== undefined) {
    switch (previewState) {
      case "SELECT_PROCESSOR_PREVIEW":
        tmp = React.createElement(
          "div",
          {
            className: "h-full w-full px-11 py-8",
          },
          React.createElement(ConnectorPreview.make, {
            connectorInfo: match$6[0],
            currentStep: "Preview",
            setCurrentStep: function (param) {},
            isUpdateFlow: true,
            isPayoutFlow: false,
            showMenuOption: false,
            setInitialValues: setInitialValues,
            getPayPalStatus: function () {},
          }),
        );
        break;
      case "LIVE_ENDPOINTS_PREVIEW":
        tmp = React.createElement(LiveEndpointsSetup.make, {
          pageView: pageView,
          setPageView: setPageView,
          previewState: previewState,
        });
        break;
      case "COMPLETE_SETUP_PREVIEW":
        tmp = null;
        break;
    }
  } else {
    var exit = 0;
    switch (pageView) {
      case "SELECT_PROCESSOR":
        tmp = React.createElement(ChooseConnector.make, {
          selectedConnector: selectedConnector,
          setSelectedConnector: match$1[1],
          pageView: pageView,
          setPageView: setPageView,
        });
        break;
      case "SETUP_CREDS":
      case "SETUP_WEBHOOK_PROCESSOR":
        exit = 1;
        break;
      case "REPLACE_API_KEYS":
      case "SETUP_WEBHOOK_USER":
        tmp = React.createElement(LiveEndpointsSetup.make, {
          pageView: pageView,
          setPageView: setPageView,
          previewState: previewState,
        });
        break;
      case "TEST_LIVE_PAYMENT":
        tmp = null;
        break;
      case "SETUP_COMPLETED":
        tmp = React.createElement(
          ProdOnboardingUIUtils.BasicAccountSetupSuccessfulPage.make,
          {
            iconName: "account-setup-completed",
            statusText: "Basic Account Setup Successful",
            buttonText: "Go to Dashboard",
            buttonOnClick: function () {
              updateSetupPageCompleted();
            },
            buttonState: match$4[0],
          },
        );
        break;
    }
    if (exit === 1) {
      tmp = React.createElement(SetupConnectorCredentials.make, {
        selectedConnector: selectedConnector,
        pageView: pageView,
        setPageView: setPageView,
        setConnectorID: setConnectorID,
      });
    }
  }
  return React.createElement(PageLoaderWrapper.make, {
    children: Caml_option.some(
      React.createElement(
        "div",
        {
          className: "flex h-screen w-screen",
        },
        React.createElement(ProdOnboardingLanding$SidebarChecklist, {
          pageView: pageView,
          getConnectorDetails: getConnectorDetails,
          setPreviewState: setPreviewState,
        }),
        React.createElement(
          "div",
          {
            className:
              "bg-hyperswitch_background flex items-center h-screen w-full overflow-scroll " +
              centerItems,
          },
          React.createElement(
            "div",
            {
              className: "flex flex-col xl:w-77-rem  mx-7 xl:ml-[7rem]",
            },
            React.createElement(
              "div",
              {
                className: "flex justify-end w-full pb-5",
              },
              React.createElement(SwitchMerchant.make, {
                userRole: match$8.user_role,
              }),
            ),
            React.createElement(
              "div",
              {
                className:
                  "h-[52rem] overflow-scroll bg-white rounded-md w-full border",
              },
              tmp,
            ),
          ),
        ),
      ),
    ),
    screenState: match$3[0],
    sectionHeight: "h-screen",
  });
}

var make = ProdOnboardingLanding;

export {
  unselectedNormalText,
  selectedNormalText,
  dividerColor,
  unselectedSubHeading,
  CheckListSection,
  ProgressBar,
  SidebarChecklist,
  make,
};
/* Icon Not a pure module */
