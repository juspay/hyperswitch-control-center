// Generated by ReScript, PLEASE EDIT WITH CARE

import * as Form from "../../../utils/Form.bs.js";
import * as Icon from "../../../components/Icon.bs.js";
import * as Modal from "../../../utils/Modal.bs.js";
import * as Table from "../../../components/Table.bs.js";
import * as React from "react";
import * as Recoil from "recoil";
import * as ToolTip from "../../../components/tooltip/ToolTip.bs.js";
import * as APIUtils from "../../APIUtils/APIUtils.bs.js";
import * as Clipboard from "../../../libraries/Clipboard.bs.js";
import * as EntityType from "../../../entities/EntityType.bs.js";
import * as LogicUtils from "../../../utils/LogicUtils.bs.js";
import * as ToastState from "../../../hooks/ToastState.bs.js";
import * as Caml_option from "rescript/lib/es6/caml_option.js";
import * as InputFields from "../../../components/InputFields.bs.js";
import * as FormRenderer from "../../../components/form/FormRenderer.bs.js";
import * as HyperswitchAtom from "../../../Recoils/HyperswitchAtom.bs.js";
import * as JsxPPXReactSupportU from "rescript/lib/es6/jsxPPXReactSupportU.js";
import * as BusinessMappingUtils from "./BusinessMappingUtils.bs.js";
import * as BusinessProfileMapper from "../../../utils/Mappers/BusinessProfileMapper.bs.js";

function BusinessMappingEntity$ProfileActions(props) {
  var profileId = props.profileId;
  var defaultProfileName = props.defaultProfileName;
  var getURL = APIUtils.useGetURL();
  var updateDetails = APIUtils.useUpdateMethod(undefined, undefined);
  var showToast = ToastState.useShowToast();
  var match = React.useState(function () {
    return false;
  });
  var setShowModal = match[1];
  var match$1 = Recoil.useRecoilState(HyperswitchAtom.businessProfilesAtom);
  var setBusinessProfiles = match$1[1];
  var businessProfiles = match$1[0];
  var initialValues = Object.fromEntries([
    ["profile_name", defaultProfileName],
  ]);
  var onSubmit = async function (values, param) {
    try {
      var url = getURL(
        "BUSINESS_PROFILE",
        "Post",
        Caml_option.some(profileId),
        undefined,
        undefined,
        undefined,
        undefined,
        undefined,
        undefined,
      );
      var res = await updateDetails(
        url,
        values,
        "Post",
        undefined,
        undefined,
        undefined,
        undefined,
      );
      var filteredProfileList = businessProfiles
        .filter(function (businessProfile) {
          return businessProfile.profile_id !== profileId;
        })
        .concat([BusinessProfileMapper.businessProfileTypeMapper(res)]);
      setBusinessProfiles(function (param) {
        return filteredProfileList;
      });
      showToast(
        "Updated profile name!",
        "ToastSuccess",
        undefined,
        undefined,
        undefined,
        undefined,
        undefined,
        undefined,
      );
    } catch (exn) {
      showToast(
        "Failed to update profile name!",
        "ToastError",
        undefined,
        undefined,
        undefined,
        undefined,
        undefined,
        undefined,
      );
    }
    setShowModal(function (param) {
      return false;
    });
    return null;
  };
  var businessName = FormRenderer.makeFieldInfo(
    "Profile Name",
    undefined,
    "profile_name",
    InputFields.textInput(
      undefined,
      undefined,
      undefined,
      undefined,
      undefined,
      undefined,
      undefined,
      undefined,
      undefined,
      undefined,
      undefined,
      undefined,
      undefined,
      undefined,
      undefined,
      undefined,
      undefined,
      undefined,
      undefined,
      undefined,
      undefined,
      undefined,
      undefined,
      undefined,
      undefined,
      undefined,
    ),
    undefined,
    undefined,
    undefined,
    undefined,
    "Eg: Hyperswitch",
    undefined,
    undefined,
    undefined,
    undefined,
    undefined,
    undefined,
    true,
    undefined,
    undefined,
    undefined,
  );
  return React.createElement(
    "div",
    {
      className: "flex gap-4 items-center",
    },
    React.createElement(ToolTip.make, {
      description: "Edit profile name",
      toolTipFor: Caml_option.some(
        React.createElement(Icon.make, {
          name: "pencil-alt",
          size: 14,
          className: "cursor-pointer",
          onClick: function (param) {
            setShowModal(function (param) {
              return true;
            });
          },
        }),
      ),
      toolTipPosition: "Top",
      contentAlign: "Left",
    }),
    React.createElement(ToolTip.make, {
      description: "Copy profile Id",
      toolTipFor: Caml_option.some(
        React.createElement(Icon.make, {
          name: "copy-code",
          size: 20,
          className: "cursor-pointer",
          onClick: function (param) {
            Clipboard.writeText(profileId);
            showToast(
              "Copied to Clipboard!",
              "ToastSuccess",
              undefined,
              undefined,
              undefined,
              undefined,
              undefined,
              undefined,
            );
          },
        }),
      ),
      toolTipPosition: "Top",
      contentAlign: "Left",
    }),
    JsxPPXReactSupportU.createElementWithKey(defaultProfileName, Modal.make, {
      showModal: match[0],
      setShowModal: setShowModal,
      children: React.createElement(Form.make, {
        children: React.createElement(
          "div",
          {
            className: "flex flex-col gap-12 h-full w-full",
          },
          React.createElement(FormRenderer.DesktopRow.make, {
            children: React.createElement(FormRenderer.FieldRenderer.make, {
              field: businessName,
              fieldWrapperClass: "w-full",
              labelClass: "!text-black font-medium !-ml-[0.5px]",
            }),
          }),
          React.createElement(
            "div",
            {
              className: "flex justify-end w-full pr-5 pb-3",
            },
            React.createElement(FormRenderer.SubmitButton.make, {
              text: "Submit changes",
              buttonSize: "Small",
            }),
          ),
        ),
        onSubmit: onSubmit,
        initialValues: initialValues,
      }),
      modalHeading: "Edit Profile name",
      modalClass: "w-1/4 m-auto",
    }),
  );
}

var ProfileActions = {
  make: BusinessMappingEntity$ProfileActions,
};

var visibleColumns = ["ProfileId", "ProfileName", "Action"];

var defaultColumns = ["ProfileId", "ProfileName", "Action"];

var allColumns = ["ProfileId", "ProfileName", "Action"];

function getHeading(colType) {
  switch (colType) {
    case "ProfileName":
      return Table.makeHeaderInfo(
        "profile_name",
        "Profile Name",
        undefined,
        true,
        undefined,
        undefined,
        undefined,
        undefined,
        undefined,
        undefined,
        undefined,
        undefined,
        undefined,
        undefined,
      );
    case "ProfileId":
      return Table.makeHeaderInfo(
        "profile_id",
        "Profile Id",
        undefined,
        true,
        undefined,
        undefined,
        undefined,
        undefined,
        undefined,
        undefined,
        undefined,
        undefined,
        undefined,
        undefined,
      );
    case "Action":
      return Table.makeHeaderInfo(
        "action",
        "Action",
        undefined,
        false,
        undefined,
        undefined,
        undefined,
        undefined,
        undefined,
        undefined,
        undefined,
        undefined,
        undefined,
        undefined,
      );
  }
}

function getCell(item, colType) {
  switch (colType) {
    case "ProfileName":
      return {
        TAG: "Text",
        _0: item.profile_name,
      };
    case "ProfileId":
      return {
        TAG: "Text",
        _0: item.profile_id,
      };
    case "Action":
      return {
        TAG: "CustomCell",
        _0: React.createElement(BusinessMappingEntity$ProfileActions, {
          defaultProfileName: item.profile_name,
          profileId: item.profile_id,
        }),
        _1: "",
      };
  }
}

function itemToObjMapper(dict) {
  return {
    merchant_id: LogicUtils.getString(dict, "merchant_id", ""),
    profile_id: LogicUtils.getString(dict, "profile_id", ""),
    profile_name: LogicUtils.getString(
      dict,
      BusinessMappingUtils.getStringFromVariant("ProfileName"),
      "",
    ),
    return_url: LogicUtils.getOptionString(dict, "return_url"),
    payment_response_hash_key: LogicUtils.getOptionString(
      dict,
      "payment_response_hash_key",
    ),
    webhook_details: BusinessProfileMapper.constructWebhookDetailsObject(
      LogicUtils.getObj(dict, "webhook_details", {}),
    ),
    authentication_connector_details:
      BusinessProfileMapper.constructAuthConnectorObject(
        LogicUtils.getObj(dict, "webhook_details", {}),
      ),
    collect_shipping_details_from_wallet_connector: LogicUtils.getOptionBool(
      dict,
      "collect_shipping_details_from_wallet_connector",
    ),
    is_connector_agnostic_mit_enabled: undefined,
    outgoing_webhook_custom_http_headers: undefined,
  };
}

function getItems(json) {
  return LogicUtils.getArrayDataFromJson(json, itemToObjMapper);
}

var businessProfileTableEntity = EntityType.makeEntity(
  "",
  getItems,
  defaultColumns,
  allColumns,
  getHeading,
  getCell,
  "",
  undefined,
  undefined,
  undefined,
  undefined,
  undefined,
  undefined,
  undefined,
  undefined,
  undefined,
  undefined,
  undefined,
  undefined,
  undefined,
  undefined,
  undefined,
  undefined,
  undefined,
  undefined,
  undefined,
  undefined,
  undefined,
  undefined,
  undefined,
  undefined,
);

export {
  ProfileActions,
  visibleColumns,
  defaultColumns,
  allColumns,
  getHeading,
  getCell,
  itemToObjMapper,
  getItems,
  businessProfileTableEntity,
};
/* businessProfileTableEntity Not a pure module */
