// Generated by ReScript, PLEASE EDIT WITH CARE

import * as React from "react";
import * as Button from "../../../../components/Button.bs.js";
import * as Recoil from "recoil";
import * as GlobalVars from "../../../../utils/GlobalVars.bs.js";
import * as LogicUtils from "../../../../utils/LogicUtils.bs.js";
import * as Caml_option from "rescript/lib/es6/caml_option.js";
import * as MixpanelHook from "../../../MixpanelHook.bs.js";
import * as GlobalProvider from "../../../../entryPoints/Provider/GlobalProvider.bs.js";
import * as EnumVariantHook from "../../../Hooks/EnumVariantHook.bs.js";
import * as HyperswitchAtom from "../../../../Recoils/HyperswitchAtom.bs.js";
import * as QuickStartUtils from "../QuickStartUtils.bs.js";
import * as ConnectorListHook from "../../../Hooks/ConnectorListHook.bs.js";
import * as QuickStartUIUtils from "../QuickStartUIUtils.bs.js";
import * as HSSelfServeSidebar from "../../../Helpers/HSSelfServeSidebar.bs.js";
import * as RescriptReactRouter from "@rescript/react/src/RescriptReactRouter.bs.js";
import * as CustomIntegrationPage from "./CustomIntegrationPage.bs.js";

function IntegrateYourAppLanding(props) {
  var mixpanelEvent = MixpanelHook.useSendEvent();
  var enumDetails = Recoil.useRecoilValue(HyperswitchAtom.enumVariantAtom);
  var typedValueOfEnum = QuickStartUtils.getTypedValueFromDict(
    LogicUtils.safeParse(enumDetails),
  );
  var postEnumDetails = EnumVariantHook.usePostEnumDetails();
  var match = React.useContext(GlobalProvider.defaultContext);
  var setQuickStartPageState = match.setQuickStartPageState;
  var quickStartPageState = match.quickStartPageState;
  var setDashboardPageState = match.setDashboardPageState;
  var match$1 = React.useState(function () {
    return QuickStartUtils.textToVariantMapper(
      typedValueOfEnum.integrationMethod.integration_type,
    );
  });
  var choiceState = match$1[0];
  var match$2 = React.useState(function () {
    return "Normal";
  });
  var setButtonState = match$2[1];
  var buttonState = match$2[0];
  var currentRoute = QuickStartUtils.textToVariantMapperForBuildHS(
    typedValueOfEnum.integrationMethod.integration_type,
  );
  var fetchConnectorListResponse = ConnectorListHook.useFetchConnectorList();
  var landingButtonGroup = React.createElement(
    "div",
    {
      className: "flex flex-col gap-4 w-full",
    },
    React.createElement(Button.make, {
      text: "I want to integrate Hyperswitch into my app",
      buttonType: "Primary",
      onClick: function (param) {
        mixpanelEvent(
          "quickstart_integration_landing",
          undefined,
          undefined,
          undefined,
          undefined,
          undefined,
        );
        setQuickStartPageState(function (param) {
          return {
            TAG: "IntegrateApp",
            _0: "CHOOSE_INTEGRATION",
          };
        });
      },
    }),
    React.createElement(Button.make, {
      text: "Go to Home",
      buttonType: "Secondary",
      onClick: function (param) {
        setDashboardPageState(function (param) {
          return "HOME";
        });
        RescriptReactRouter.replace(GlobalVars.appendDashboardPath("/home"));
      },
    }),
  );
  var handleIntegration = async function () {
    try {
      setButtonState(function (param) {
        return "Loading";
      });
      var integartionValue = {
        integration_type: choiceState,
      };
      var enumVariant =
        QuickStartUtils.variantToEnumMapper(quickStartPageState);
      await postEnumDetails(
        {
          TAG: "IntegrationMethod",
          _0: integartionValue,
        },
        enumVariant,
      );
      fetchConnectorListResponse();
      setQuickStartPageState(function (param) {
        return {
          TAG: "IntegrateApp",
          _0: "CUSTOM_INTEGRATION",
        };
      });
      return setButtonState(function (param) {
        return "Normal";
      });
    } catch (exn) {
      return setButtonState(function (param) {
        return "Normal";
      });
    }
  };
  var handleMarkAsDone = async function () {
    try {
      var enumVariant =
        QuickStartUtils.variantToEnumMapper(quickStartPageState);
      await postEnumDetails(
        {
          TAG: "Boolean",
          _0: true,
        },
        enumVariant,
      );
    } catch (exn) {}
    return setQuickStartPageState(function (param) {
      return {
        TAG: "GoLive",
        _0: "LANDING",
      };
    });
  };
  React.useEffect(
    function () {
      if (choiceState === "NotSelected") {
        setButtonState(function (param) {
          return "Disabled";
        });
      } else {
        setButtonState(function (param) {
          return "Normal";
        });
      }
    },
    [choiceState],
  );
  var tmp;
  switch (props.integrateAppValue) {
    case "LANDING":
      tmp = React.createElement(
        "div",
        {
          className: "h-full flex-1 flex flex-col items-center justify-center",
        },
        React.createElement(QuickStartUIUtils.StepCompletedPage.make, {
          buttonGroup: Caml_option.some(landingButtonGroup),
          headerText:
            "Configuration is complete. You can now start integrating with us!",
        }),
      );
      break;
    case "CHOOSE_INTEGRATION":
      tmp = React.createElement(
        "div",
        {
          className: "flex h-full",
        },
        React.createElement(HSSelfServeSidebar.make, {
          heading: "Integrate your app",
          sidebarOptions: QuickStartUtils.getSidebarOptionsForIntegrateYourApp(
            enumDetails,
            quickStartPageState,
            currentRoute,
            choiceState,
          ),
        }),
        React.createElement(
          "div",
          {
            className: "flex-1 flex flex-col items-center justify-center",
          },
          React.createElement(QuickStartUIUtils.LandingPageChoice.make, {
            choiceState: choiceState,
            setChoiceState: match$1[1],
            listChoices: QuickStartUtils.integrateYourAppArray,
            nextButton: React.createElement(Button.make, {
              buttonState: buttonState,
              text: "Proceed",
              buttonType: "Primary",
              buttonSize: "Small",
              onClick: function (param) {
                mixpanelEvent(
                  "quickstart_integration_landing_option",
                  undefined,
                  undefined,
                  undefined,
                  undefined,
                  undefined,
                );
                handleIntegration();
              },
              showBtnTextToolTip: buttonState === "Disabled",
              tooltipText: "Please select one of the choices",
            }),
            headerText: "How would you like to integrate?",
            isVerticalTile: true,
          }),
        ),
      );
      break;
    case "CUSTOM_INTEGRATION":
      tmp = React.createElement(
        "div",
        {
          className: "flex h-full",
        },
        React.createElement(HSSelfServeSidebar.make, {
          heading: "Integrate your app",
          sidebarOptions: QuickStartUtils.getSidebarOptionsForIntegrateYourApp(
            enumDetails,
            quickStartPageState,
            currentRoute,
            choiceState,
          ),
        }),
        React.createElement(
          "div",
          {
            className: "flex-1 flex flex-col items-center justify-center ml-12",
          },
          React.createElement(CustomIntegrationPage.make, {
            currentRoute: currentRoute,
            markAsDone: handleMarkAsDone,
          }),
        ),
      );
      break;
  }
  return React.createElement(React.Fragment, {
    children: Caml_option.some(tmp),
  });
}

var make = IntegrateYourAppLanding;

export { make };
/* react Not a pure module */
