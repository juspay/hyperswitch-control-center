// Generated by ReScript, PLEASE EDIT WITH CARE

import * as React from "react";
import * as Js_exn from "rescript/lib/es6/js_exn.js";
import * as APIUtils from "../APIUtils/APIUtils.bs.js";
import * as RenderIf from "../../utils/RenderIf.bs.js";
import * as PageUtils from "../Helpers/PageUtils.bs.js";
import * as LogicUtils from "../../utils/LogicUtils.bs.js";
import * as OrderUtils from "../../components/OrderUtils.bs.js";
import * as Caml_option from "rescript/lib/es6/caml_option.js";
import * as Core__Option from "@rescript/core/src/Core__Option.bs.js";
import * as FormRenderer from "../../components/form/FormRenderer.bs.js";
import * as CustomersEntity from "./CustomersEntity.bs.js";
import * as PageLoaderWrapper from "../Helpers/PageLoaderWrapper.bs.js";
import * as SearchResultsPage from "../Analytics/GlobalSearchResults/SearchResultsPage.bs.js";
import * as Caml_js_exceptions from "rescript/lib/es6/caml_js_exceptions.js";
import * as JsxPPXReactSupportU from "rescript/lib/es6/jsxPPXReactSupportU.js";
import * as BreadCrumbNavigation from "../../utils/BreadCrumbNavigation.bs.js";
import * as GlobalSearchBarUtils from "../Analytics/GlobalSearch/GlobalSearchBarUtils.bs.js";
import * as SearchResultsPageUtils from "../Analytics/GlobalSearchResults/SearchResultsPageUtils.bs.js";

function ShowCustomers$CustomerInfo$Details(props) {
  var children = props.children;
  var __bgColor = props.bgColor;
  var __widthClass = props.widthClass;
  var __justifyClassName = props.justifyClassName;
  var __excludeColKeys = props.excludeColKeys;
  var getCell = props.getCell;
  var getHeading = props.getHeading;
  var data = props.data;
  var excludeColKeys = __excludeColKeys !== undefined ? __excludeColKeys : [];
  var justifyClassName =
    __justifyClassName !== undefined ? __justifyClassName : "justify-start";
  var widthClass = __widthClass !== undefined ? __widthClass : "w-1/4";
  var bgColor =
    __bgColor !== undefined
      ? __bgColor
      : "bg-white dark:bg-jp-gray-lightgray_background";
  return React.createElement(
    OrderUtils.Section.make,
    {
      children: null,
      customCssClass:
        "border border-jp-gray-940 border-opacity-75 dark:border-jp-gray-960 " +
        bgColor +
        " rounded-md p-5",
    },
    React.createElement(FormRenderer.DesktopRow.make, {
      children: React.createElement(
        "div",
        {
          className:
            "flex flex-wrap " +
            justifyClassName +
            " dark:bg-jp-gray-lightgray_background dark:border-jp-gray-no_data_border",
        },
        props.detailsFields.map(function (colType, i) {
          return JsxPPXReactSupportU.createElementWithKey(
            i.toString(),
            RenderIf.make,
            {
              condition: !excludeColKeys.includes(colType),
              children: React.createElement(
                "div",
                {
                  className: "flex " + widthClass + " items-center",
                },
                React.createElement(OrderUtils.DisplayKeyValueParams.make, {
                  heading: getHeading(colType),
                  value: getCell(data, colType),
                  customMoneyStyle: "!font-normal !text-sm",
                  labelMargin: "!py-0 mt-2",
                  textColor: "!font-normal !text-jp-gray-700",
                  overiddingHeadingStyles: "text-black text-sm font-medium",
                }),
              ),
            },
          );
        }),
      ),
    }),
    React.createElement(RenderIf.make, {
      condition: Core__Option.isSome(children),
      children: Core__Option.getOr(children, null),
    }),
  );
}

var Details = {
  make: ShowCustomers$CustomerInfo$Details,
};

function ShowCustomers$CustomerInfo(props) {
  var customerData = CustomersEntity.itemToObjMapper(props.dict);
  return React.createElement(
    React.Fragment,
    {},
    React.createElement(
      "div",
      {
        className:
          "font-bold text-fs-16 dark:text-white dark:text-opacity-75 mt-4 mb-4",
      },
      "Summary",
    ),
    React.createElement(ShowCustomers$CustomerInfo$Details, {
      data: customerData,
      getHeading: CustomersEntity.getHeading,
      getCell: CustomersEntity.getCell,
      detailsFields: CustomersEntity.allColumns,
    }),
  );
}

var CustomerInfo = {
  Details: Details,
  make: ShowCustomers$CustomerInfo,
};

function ShowCustomers$CustomerDetails(props) {
  var id = props.id;
  var getURL = APIUtils.useGetURL();
  var fetchData = APIUtils.useUpdateMethod(undefined, undefined);
  var match = React.useState(function () {
    return [];
  });
  var setSearchResults = match[1];
  var match$1 = React.useState(function () {
    return "Loading";
  });
  var setScreenState = match$1[1];
  var getSearchResults = async function () {
    setScreenState(function (param) {
      return "Loading";
    });
    try {
      var url = getURL(
        "GLOBAL_SEARCH",
        "Post",
        undefined,
        undefined,
        undefined,
        undefined,
        undefined,
        undefined,
        undefined,
      );
      var body = LogicUtils.getJsonFromArrayOfJson([["query", id]]);
      var response = await fetchData(
        url,
        body,
        "Post",
        undefined,
        undefined,
        undefined,
        undefined,
      );
      var remote_results = GlobalSearchBarUtils.parseResponse(response);
      var data_local_results = [];
      var data = {
        local_results: data_local_results,
        remote_results: remote_results,
        searchText: id,
      };
      var match = SearchResultsPageUtils.getSearchresults(data);
      var results = match[0];
      setSearchResults(function (param) {
        return results;
      });
      return setScreenState(function (param) {
        return "Success";
      });
    } catch (exn) {
      return setScreenState(function (param) {
        return "Success";
      });
    }
  };
  React.useEffect(function () {
    getSearchResults();
  }, []);
  return React.createElement(PageLoaderWrapper.make, {
    children: Caml_option.some(
      React.createElement(
        "div",
        {
          className: "mt-5",
        },
        React.createElement(SearchResultsPage.SearchResultsComponent.make, {
          searchResults: match[0],
          searchText: id,
        }),
      ),
    ),
    screenState: match$1[0],
  });
}

var CustomerDetails = {
  make: ShowCustomers$CustomerDetails,
};

function ShowCustomers(props) {
  var id = props.id;
  var getURL = APIUtils.useGetURL();
  var fetchDetails = APIUtils.useGetMethod(undefined, undefined);
  var match = React.useState(function () {
    return "Loading";
  });
  var setScreenState = match[1];
  var match$1 = React.useState(function () {
    return null;
  });
  var setCustomersData = match$1[1];
  var fetchCustomersData = async function () {
    try {
      setScreenState(function (param) {
        return "Loading";
      });
      var customersUrl = getURL(
        "CUSTOMERS",
        "Get",
        Caml_option.some(id),
        undefined,
        undefined,
        undefined,
        undefined,
        undefined,
        undefined,
      );
      var response = await fetchDetails(customersUrl);
      setCustomersData(function (param) {
        return response;
      });
      return setScreenState(function (param) {
        return "Success";
      });
    } catch (raw_e) {
      var e = Caml_js_exceptions.internalToOCamlException(raw_e);
      if (e.RE_EXN_ID === Js_exn.$$Error) {
        var err = Core__Option.getOr(e._1.message, "Failed to Fetch!");
        return setScreenState(function (param) {
          return {
            TAG: "Error",
            _0: err,
          };
        });
      }
      throw e;
    }
  };
  React.useEffect(function () {
    fetchCustomersData();
  }, []);
  return React.createElement(PageLoaderWrapper.make, {
    children: Caml_option.some(
      React.createElement(
        "div",
        {
          className: "flex flex-col overflow-scroll",
        },
        React.createElement(
          "div",
          {
            className: "mb-4 flex justify-between",
          },
          React.createElement(
            "div",
            {
              className: "flex items-center",
            },
            React.createElement(
              "div",
              undefined,
              React.createElement(PageUtils.PageHeading.make, {
                title: "Customers",
              }),
              React.createElement(BreadCrumbNavigation.make, {
                path: [
                  {
                    title: "Customers",
                    link: "/customers",
                  },
                ],
                currentPageTitle: id,
                cursorStyle: "cursor-pointer",
              }),
            ),
            React.createElement("div", undefined),
          ),
        ),
        React.createElement(ShowCustomers$CustomerInfo, {
          dict: LogicUtils.getDictFromJsonObject(match$1[0]),
        }),
        React.createElement(ShowCustomers$CustomerDetails, {
          id: id,
        }),
      ),
    ),
    screenState: match[0],
  });
}

var make = ShowCustomers;

export { CustomerInfo, CustomerDetails, make };
/* react Not a pure module */
