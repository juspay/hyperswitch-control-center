// Generated by ReScript, PLEASE EDIT WITH CARE

import * as React from "react";
import * as Belt_Array from "rescript/lib/es6/belt_Array.js";
import * as Core__JSON from "@rescript/core/src/Core__JSON.bs.js";
import * as LogicUtils from "../../utils/LogicUtils.bs.js";
import * as Caml_option from "rescript/lib/es6/caml_option.js";
import * as Core__Array from "@rescript/core/src/Core__Array.bs.js";
import * as InputFields from "../../components/InputFields.bs.js";
import * as Core__Option from "@rescript/core/src/Core__Option.bs.js";
import * as FormRenderer from "../../components/form/FormRenderer.bs.js";
import * as PayoutsEntity from "./PayoutsEntity.bs.js";
import * as FilterSelectBox from "../../components/FilterSelectBox.bs.js";
import * as HelperComponents from "../Helpers/HelperComponents.bs.js";

async function getPayoutsList(
  filterValueJson,
  updateDetails,
  setPayoutsData,
  setScreenState,
  offset,
  setTotalCount,
  setOffset,
  getURL,
) {
  setScreenState(function (param) {
    return "Loading";
  });
  try {
    var payoutsUrl = getURL(
      "PAYOUTS",
      "Post",
      undefined,
      undefined,
      undefined,
      undefined,
      undefined,
      undefined,
      undefined,
    );
    var res = await updateDetails(
      payoutsUrl,
      filterValueJson,
      "Post",
      undefined,
      undefined,
      undefined,
      undefined,
    );
    var data = LogicUtils.getArrayFromDict(
      LogicUtils.getDictFromJsonObject(res),
      "data",
      [],
    );
    var total = LogicUtils.getInt(
      LogicUtils.getDictFromJsonObject(res),
      "size",
      0,
    );
    var arr = Core__Array.make(offset, {});
    if (total <= offset) {
      setOffset(function (param) {
        return 0;
      });
    }
    if (total <= 0) {
      return setScreenState(function (param) {
        return "Custom";
      });
    }
    var payoutDataDictArr = Belt_Array.keepMap(data, Core__JSON.Decode.object);
    var payoutData = arr
      .concat(payoutDataDictArr)
      .map(PayoutsEntity.itemToObjMapper);
    var list = payoutData.map(function (prim) {
      return prim;
    });
    setPayoutsData(function (param) {
      return list;
    });
    setTotalCount(function (param) {
      return total;
    });
    return setScreenState(function (param) {
      return "Success";
    });
  } catch (exn) {
    return setScreenState(function (param) {
      return {
        TAG: "Error",
        _0: "Failed to fetch",
      };
    });
  }
}

var customUI = React.createElement(HelperComponents.BluredTableComponent.make, {
  infoText: "No payout records as of now. Try initiating a payout.",
  moduleName: "",
  showRedirectCTA: false,
});

var startTimeFilterKey = "start_time";

var endTimeFilterKey = "end_time";

function filterByData(txnArr, value) {
  var searchText = LogicUtils.getStringFromJson(value, "");
  return Belt_Array.keepMap(
    Belt_Array.keepMap(txnArr, function (prim) {
      if (prim == null) {
        return;
      } else {
        return Caml_option.some(prim);
      }
    }),
    function (data) {
      var valueArr = Core__Array.reduce(
        Object.entries(data).map(function (item) {
          return LogicUtils.getStringFromJson(item[1], "")
            .toLowerCase()
            .includes(searchText);
        }),
        false,
        function (acc, item) {
          if (item) {
            return true;
          } else {
            return acc;
          }
        },
      );
      if (valueArr) {
        return Caml_option.some(data);
      }
    },
  );
}

function initialFixedFilter() {
  return [
    {
      field: FormRenderer.makeMultiInputFieldInfo(
        "",
        undefined,
        undefined,
        undefined,
        undefined,
        undefined,
        undefined,
        undefined,
        false,
        InputFields.filterDateRangeField(
          startTimeFilterKey,
          endTimeFilterKey,
          "YYYY-MM-DDTHH:mm:ss[Z]",
          false,
          true,
          false,
          [
            {
              TAG: "Hour",
              _0: 0.5,
            },
            {
              TAG: "Hour",
              _0: 1.0,
            },
            {
              TAG: "Hour",
              _0: 2.0,
            },
            "Today",
            "Yesterday",
            {
              TAG: "Day",
              _0: 2.0,
            },
            {
              TAG: "Day",
              _0: 7.0,
            },
            {
              TAG: "Day",
              _0: 30.0,
            },
            "ThisMonth",
            "LastMonth",
          ],
          false,
          2,
          180,
          undefined,
          undefined,
          undefined,
          undefined,
          undefined,
          undefined,
          undefined,
        ),
        undefined,
        [],
        undefined,
      ),
      localFilter: undefined,
    },
  ];
}

function getOptionsForPayoutFilters(dict, filterValues) {
  var arr = LogicUtils.getStrArrayFromJsonArray(
    LogicUtils.getArrayFromDict(filterValues, "connector", []),
  );
  return arr.flatMap(function (connector) {
    var connectorLabelArr = LogicUtils.getArrayFromDict(
      LogicUtils.getDictfromDict(dict, "connector"),
      connector,
      [],
    );
    return connectorLabelArr.map(function (item) {
      var label = LogicUtils.getString(
        LogicUtils.getDictFromJsonObject(item),
        "connector_label",
        "",
      );
      var value = LogicUtils.getString(
        LogicUtils.getDictFromJsonObject(item),
        "merchant_connector_id",
        "",
      );
      return {
        label: label,
        value: value,
      };
    });
  });
}

function initialFilters(json, param) {
  return Object.entries(LogicUtils.getDictFromJsonObject(json)).map(
    function (item) {
      var key = item[0];
      return {
        field: FormRenderer.makeFieldInfo(
          "",
          undefined,
          key,
          InputFields.filterMultiSelectInput(
            FilterSelectBox.makeOptions(
              Core__Option.getOr(Core__JSON.Decode.array(item[1]), []).map(
                function (item) {
                  return Core__Option.getOr(Core__JSON.Decode.string(item), "");
                },
              ),
            ),
            undefined,
            "Select " + key,
            undefined,
            undefined,
            false,
            undefined,
            undefined,
            true,
            undefined,
            undefined,
            undefined,
            undefined,
            "bg-none",
            undefined,
            undefined,
            true,
            true,
            undefined,
            undefined,
            undefined,
            undefined,
            undefined,
            undefined,
            undefined,
            undefined,
            undefined,
            undefined,
            undefined,
            undefined,
            undefined,
            undefined,
            undefined,
            undefined,
            undefined,
            undefined,
            undefined,
            undefined,
            undefined,
            undefined,
            undefined,
            undefined,
            undefined,
            undefined,
            undefined,
            undefined,
            undefined,
            undefined,
          ),
          undefined,
          undefined,
          undefined,
          undefined,
          undefined,
          undefined,
          undefined,
          undefined,
          undefined,
          undefined,
          undefined,
          undefined,
          undefined,
          undefined,
          undefined,
        ),
        localFilter: filterByData,
      };
    },
  );
}

export {
  getPayoutsList,
  customUI,
  startTimeFilterKey,
  endTimeFilterKey,
  filterByData,
  initialFixedFilter,
  getOptionsForPayoutFilters,
  initialFilters,
};
/* customUI Not a pure module */
