// Generated by ReScript, PLEASE EDIT WITH CARE

import * as JsSha256 from "js-sha256";
import * as LogicUtils from "../../../../utils/LogicUtils.bs.js";

function sortByCreatedAt(log1, log2) {
  var getKey = function (dict) {
    return new Date(
      LogicUtils.getString(
        LogicUtils.getDictFromJsonObject(dict),
        "created_at",
        "",
      ),
    );
  };
  var keyA = getKey(log1);
  var keyB = getKey(log2);
  return LogicUtils.compareLogic(keyA, keyB);
}

function itemToObjMapper(flowString) {
  switch (flowString) {
    case "AttachDisputeEvidence":
      return "AttachDisputeEvidence";
    case "DisputesEvidenceSubmit":
      return "DisputesEvidenceSubmit";
    case "IncomingWebhookReceive":
      return "IncomingWebhookReceive";
    case "PaymentsCancel":
      return "PaymentsCancel";
    case "PaymentsCapture":
      return "PaymentsCapture";
    case "PaymentsConfirm":
      return "PaymentsConfirm";
    case "PaymentsCreate":
      return "PaymentsCreate";
    case "PaymentsStart":
      return "PaymentsStart";
    case "PaymentsUpdate":
      return "PaymentsUpdate";
    case "RefundsCreate":
      return "RefundsCreate";
    case "RefundsUpdate":
      return "RefundsUpdate";
    case "RetrieveDisputeEvidence":
      return "RetrieveDisputeEvidence";
    default:
      return "NotDefined";
  }
}

function nameToURLMapper(id, merchantId) {
  return function (urlName) {
    var match = itemToObjMapper(urlName);
    switch (match) {
      case "PaymentsCancel":
        return "/payments/" + id + "/cancel";
      case "PaymentsCapture":
        return "/payments/" + id + "/capture";
      case "PaymentsConfirm":
        return "/payments/" + id + "/confirm";
      case "PaymentsCreate":
        return "/payments";
      case "PaymentsStart":
        return "/payments/redirect/" + id + "/" + merchantId;
      case "PaymentsUpdate":
        return "/payments/" + id;
      case "RefundsCreate":
        return "/refunds";
      case "RefundsUpdate":
        return "/refunds/" + id;
      case "DisputesEvidenceSubmit":
      case "AttachDisputeEvidence":
        return "/disputes/evidence";
      case "RetrieveDisputeEvidence":
        return "/disputes/evidence/" + id;
      case "IncomingWebhookReceive":
      case "NotDefined":
        return urlName;
    }
  };
}

var filteredKeys = [
  "value",
  "merchant_id",
  "created_at_precise",
  "component",
  "platform",
  "version",
];

var detailsSectionFilterKeys = [
  "content",
  "created_at",
  "event_type",
  "flow_type",
  "api_flow",
  "request",
  "response",
  "user_agent",
  "ip_addr",
  "flow",
  "masked_response",
  "http_method",
  "hs_latency",
  "status_code",
];

function parseSdkResponse(arr) {
  var sourceMapper = function (source) {
    switch (source) {
      case "ORCA-LOADER":
        return "HYPERLOADER";
      case "ORCA-PAYMENT-PAGE":
      case "STRIPE_PAYMENT_SHEET":
        return "PAYMENT_SHEET";
      default:
        return source;
    }
  };
  var sdkLogsArray = arr.map(function ($$event) {
    var eventDict = LogicUtils.getDictFromJsonObject($$event);
    var eventName = LogicUtils.getString(eventDict, "event_name", "");
    var timestamp = LogicUtils.getString(eventDict, "created_at_precise", "");
    var logType = LogicUtils.getString(eventDict, "log_type", "");
    var updatedEventName =
      logType === "INFO" ? eventName.replace("Call", "Response") : eventName;
    eventDict["event_name"] = updatedEventName;
    eventDict["event_id"] = JsSha256.sha256(updatedEventName + timestamp);
    eventDict["source"] = sourceMapper(
      LogicUtils.getString(eventDict, "source", ""),
    );
    eventDict["checkout_platform"] = LogicUtils.getString(
      eventDict,
      "component",
      "",
    );
    eventDict["customer_device"] = LogicUtils.getString(
      eventDict,
      "platform",
      "",
    );
    eventDict["sdk_version"] = LogicUtils.getString(eventDict, "version", "");
    eventDict["event_name"] = updatedEventName;
    eventDict["created_at"] = timestamp;
    return eventDict;
  });
  return sdkLogsArray.filter(function (sdkLog) {
    var eventDict = LogicUtils.getDictFromJsonObject(sdkLog);
    var eventName = LogicUtils.getString(eventDict, "event_name", "");
    var filteredEventNames = ["OrcaElementsCalled"];
    return !filteredEventNames.includes(eventName);
  });
}

function apiNameMapper(apiName) {
  if (apiName === "PSync") {
    return "Payments Sync";
  } else {
    return apiName;
  }
}

export {
  sortByCreatedAt,
  itemToObjMapper,
  nameToURLMapper,
  filteredKeys,
  detailsSectionFilterKeys,
  parseSdkResponse,
  apiNameMapper,
};
/* js-sha256 Not a pure module */
