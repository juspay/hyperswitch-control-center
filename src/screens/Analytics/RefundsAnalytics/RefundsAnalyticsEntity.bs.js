// Generated by ReScript, PLEASE EDIT WITH CARE

import * as Table from "../../../components/Table.bs.js";
import * as Caml_obj from "rescript/lib/es6/caml_obj.js";
import * as Core__JSON from "@rescript/core/src/Core__JSON.bs.js";
import * as EntityType from "../../../entities/EntityType.bs.js";
import * as LogicUtils from "../../../utils/LogicUtils.bs.js";
import * as Core__Option from "@rescript/core/src/Core__Option.bs.js";
import * as DynamicChart from "../../../components/DynamicChart.bs.js";
import * as DateTimeUtils from "../../../utils/DateTimeUtils.bs.js";
import * as AnalyticsTypes from "../AnalyticsTypes.bs.js";
import * as AnalyticsUtils from "../AnalyticsUtils.bs.js";
import * as HSAnalyticsUtils from "../HSAnalyticsUtils.bs.js";
import * as DynamicSingleStat from "../../../components/DynamicSingleStat.bs.js";

var domain = "refunds";

function colMapper(col) {
  switch (col) {
    case "SuccessRate":
      return "refund_success_rate";
    case "Count":
      return "refund_count";
    case "SuccessCount":
      return "refund_success_count";
    case "ProcessedAmount":
      return "refund_processed_amount";
    case "Connector":
      return "connector";
    case "RefundMethod":
      return "refund_method";
    case "Currency":
      return "currency";
    case "Status":
      return "refund_status";
    case "NoCol":
      return "";
  }
}

function tableItemToObjMapper(dict) {
  return {
    refund_success_rate: LogicUtils.getFloat(dict, "refund_success_rate", 0.0),
    refund_count: LogicUtils.getFloat(dict, "refund_count", 0.0),
    refund_success_count: LogicUtils.getFloat(
      dict,
      "refund_success_count",
      0.0,
    ),
    refund_processed_amount: LogicUtils.getFloat(
      dict,
      "refund_processed_amount",
      0.0,
    ),
    connector: LogicUtils.snakeToTitle(
      LogicUtils.getString(dict, "connector", "NA"),
    ),
    refund_method: LogicUtils.snakeToTitle(
      LogicUtils.getString(dict, "refund_method", "NA"),
    ),
    currency: LogicUtils.snakeToTitle(
      LogicUtils.getString(dict, "currency", "NA"),
    ),
    refund_status: LogicUtils.snakeToTitle(
      LogicUtils.getString(dict, "refund_status", "NA"),
    ),
  };
}

function getUpdatedHeading(param, param$1) {
  return function (colType) {
    var key = colMapper(colType);
    switch (colType) {
      case "SuccessRate":
        return Table.makeHeaderInfo(
          key,
          "Success Rate",
          "NumericType",
          false,
          undefined,
          undefined,
          undefined,
          undefined,
          undefined,
          undefined,
          undefined,
          undefined,
          undefined,
          undefined,
        );
      case "Count":
        return Table.makeHeaderInfo(
          key,
          "Refund Count",
          "NumericType",
          false,
          undefined,
          undefined,
          undefined,
          undefined,
          undefined,
          undefined,
          undefined,
          undefined,
          undefined,
          undefined,
        );
      case "SuccessCount":
        return Table.makeHeaderInfo(
          key,
          "Refund Success Count",
          "NumericType",
          false,
          undefined,
          undefined,
          undefined,
          undefined,
          undefined,
          undefined,
          undefined,
          undefined,
          undefined,
          undefined,
        );
      case "ProcessedAmount":
        return Table.makeHeaderInfo(
          key,
          "Refund Processed Amount",
          "NumericType",
          false,
          undefined,
          undefined,
          undefined,
          undefined,
          undefined,
          undefined,
          undefined,
          undefined,
          undefined,
          undefined,
        );
      case "Connector":
        return Table.makeHeaderInfo(
          key,
          "Connector",
          "DropDown",
          false,
          undefined,
          undefined,
          undefined,
          undefined,
          undefined,
          undefined,
          undefined,
          undefined,
          undefined,
          undefined,
        );
      case "RefundMethod":
        return Table.makeHeaderInfo(
          key,
          "RefundMethod",
          "DropDown",
          false,
          undefined,
          undefined,
          undefined,
          undefined,
          undefined,
          undefined,
          undefined,
          undefined,
          undefined,
          undefined,
        );
      case "Currency":
        return Table.makeHeaderInfo(
          key,
          "Currency",
          "DropDown",
          false,
          undefined,
          undefined,
          undefined,
          undefined,
          undefined,
          undefined,
          undefined,
          undefined,
          undefined,
          undefined,
        );
      case "Status":
        return Table.makeHeaderInfo(
          key,
          "Status",
          "DropDown",
          false,
          undefined,
          undefined,
          undefined,
          undefined,
          undefined,
          undefined,
          undefined,
          undefined,
          undefined,
          undefined,
        );
      case "NoCol":
        return Table.makeHeaderInfo(
          key,
          "",
          undefined,
          false,
          undefined,
          undefined,
          undefined,
          undefined,
          undefined,
          undefined,
          undefined,
          undefined,
          undefined,
          undefined,
        );
    }
  };
}

function getCell(refundTable, colType) {
  var usaNumberAbbreviation = function (labelValue) {
    return LogicUtils.shortNum(
      labelValue,
      LogicUtils.getDefaultNumberFormat(),
      undefined,
      undefined,
    );
  };
  var percentFormat = function (value) {
    return value.toFixed(2) + "%";
  };
  switch (colType) {
    case "SuccessRate":
      return {
        TAG: "Numeric",
        _0: refundTable.refund_success_rate,
        _1: percentFormat,
      };
    case "Count":
      return {
        TAG: "Numeric",
        _0: refundTable.refund_count,
        _1: usaNumberAbbreviation,
      };
    case "SuccessCount":
      return {
        TAG: "Numeric",
        _0: refundTable.refund_success_count,
        _1: usaNumberAbbreviation,
      };
    case "ProcessedAmount":
      return {
        TAG: "Numeric",
        _0: refundTable.refund_processed_amount / 100.0,
        _1: usaNumberAbbreviation,
      };
    case "Connector":
      return {
        TAG: "Text",
        _0: refundTable.connector,
      };
    case "RefundMethod":
      return {
        TAG: "Text",
        _0: refundTable.refund_method,
      };
    case "Currency":
      return {
        TAG: "Text",
        _0: refundTable.currency,
      };
    case "Status":
      return {
        TAG: "Text",
        _0: refundTable.refund_status,
      };
    case "NoCol":
      return {
        TAG: "Text",
        _0: "",
      };
  }
}

function getRefundTable(json) {
  return LogicUtils.getArrayFromJson(json, []).map(function (item) {
    return tableItemToObjMapper(LogicUtils.getDictFromJsonObject(item));
  });
}

function refundTableEntity() {
  return EntityType.makeEntity(
    window._env_.apiBaseUrl + "/analytics/v1/metrics/" + domain,
    getRefundTable,
    AnalyticsTypes.defaultRefundColumns,
    AnalyticsTypes.allRefundColumns,
    getUpdatedHeading(undefined, undefined),
    getCell,
    "queryData",
    undefined,
    undefined,
    undefined,
    undefined,
    undefined,
    undefined,
    undefined,
    undefined,
    undefined,
    undefined,
    undefined,
    undefined,
    undefined,
    undefined,
    undefined,
    undefined,
    undefined,
    [HSAnalyticsUtils.startTimeFilterKey, HSAnalyticsUtils.endTimeFilterKey],
    undefined,
    undefined,
    undefined,
    undefined,
    undefined,
    undefined,
  );
}

var singleStateInitialValue = {
  refund_success_rate: 0.0,
  refund_count: 0,
  refund_success_count: 0,
  refund_processed_amount: 0.0,
};

var singleStateSeriesInitialValue = {
  refund_success_rate: 0.0,
  refund_count: 0,
  refund_success_count: 0,
  time_series: "",
  refund_processed_amount: 0.0,
};

function singleStateItemToObjMapper(json) {
  return Core__Option.getOr(
    Core__Option.map(Core__JSON.Decode.object(json), function (dict) {
      return {
        refund_success_rate: LogicUtils.getFloat(
          dict,
          "refund_success_rate",
          0.0,
        ),
        refund_count: LogicUtils.getInt(dict, "refund_count", 0),
        refund_success_count: LogicUtils.getInt(
          dict,
          "refund_success_count",
          0,
        ),
        refund_processed_amount: LogicUtils.getFloat(
          dict,
          "refund_processed_amount",
          0.0,
        ),
      };
    }),
    singleStateInitialValue,
  );
}

function singleStateSeriesItemToObjMapper(json) {
  return Core__Option.getOr(
    Core__Option.map(Core__JSON.Decode.object(json), function (dict) {
      return {
        refund_success_rate: HSAnalyticsUtils.setPrecision(
          LogicUtils.getFloat(dict, "refund_success_rate", 0.0),
          undefined,
          undefined,
        ),
        refund_count: LogicUtils.getInt(dict, "refund_count", 0),
        refund_success_count: LogicUtils.getInt(
          dict,
          "refund_success_count",
          0,
        ),
        time_series: LogicUtils.getString(dict, "time_bucket", ""),
        refund_processed_amount: HSAnalyticsUtils.setPrecision(
          LogicUtils.getFloat(dict, "refund_processed_amount", 0.0),
          undefined,
          undefined,
        ),
      };
    }),
    singleStateSeriesInitialValue,
  );
}

function itemToObjMapper(json) {
  return HSAnalyticsUtils.getQueryData(json).map(function (json) {
    return singleStateItemToObjMapper(json);
  });
}

function timeSeriesObjMapper(json) {
  return HSAnalyticsUtils.getQueryData(json).map(function (json) {
    return singleStateSeriesItemToObjMapper(json);
  });
}

var defaultColumns = [
  {
    sectionName: "",
    columns: DynamicSingleStat.generateDefaultStateColumns([
      "SuccessRate",
      "Count",
      "SuccessCount",
      "ProcessedAmount",
    ]),
  },
];

function compareLogic(firstValue, secondValue) {
  var temp2 = secondValue[0];
  var temp1 = firstValue[0];
  if (Caml_obj.equal(temp1, temp2)) {
    return 0;
  } else if (Caml_obj.greaterthan(temp1, temp2)) {
    return -1;
  } else {
    return 1;
  }
}

function constructData(key, singlestatTimeseriesData) {
  switch (key) {
    case "refund_count":
      return singlestatTimeseriesData
        .map(function (ob) {
          return [
            DateTimeUtils.utcToISTDate(
              new Date(DateTimeUtils.parseAsFloat(ob.time_series)),
            ).valueOf(),
            ob.refund_count,
          ];
        })
        .toSorted(compareLogic);
    case "refund_processed_amount":
      return singlestatTimeseriesData
        .map(function (ob) {
          return [
            DateTimeUtils.utcToISTDate(
              new Date(DateTimeUtils.parseAsFloat(ob.time_series)),
            ).valueOf(),
            ob.refund_processed_amount / 100.0,
          ];
        })
        .toSorted(compareLogic);
    case "refund_success_count":
      return singlestatTimeseriesData
        .map(function (ob) {
          return [
            DateTimeUtils.utcToISTDate(
              new Date(DateTimeUtils.parseAsFloat(ob.time_series)),
            ).valueOf(),
            ob.refund_success_count,
          ];
        })
        .toSorted(compareLogic);
    case "refund_success_rate":
      return singlestatTimeseriesData
        .map(function (ob) {
          return [
            DateTimeUtils.utcToISTDate(
              new Date(DateTimeUtils.parseAsFloat(ob.time_series)),
            ).valueOf(),
            ob.refund_success_rate,
          ];
        })
        .toSorted(compareLogic);
    default:
      return [];
  }
}

function getStatData(
  singleStatData,
  timeSeriesData,
  deltaTimestampData,
  colType,
  _mode,
) {
  switch (colType) {
    case "SuccessRate":
      return {
        title:
          LogicUtils.getFirstLetterCaps(domain, undefined, undefined) +
          " Success Rate",
        tooltipText: "Successful refund over total refund initiated",
        deltaTooltipComponent: AnalyticsUtils.singlestatDeltaTooltipFormat(
          singleStatData.refund_success_rate,
          deltaTimestampData.currentSr,
        ),
        value: singleStatData.refund_success_rate,
        delta: Number(singleStatData.refund_success_rate.toFixed(2)),
        data: constructData("refund_success_rate", timeSeriesData),
        statType: "Rate",
        showDelta: false,
      };
    case "Count":
      return {
        title: "Overall Refunds",
        tooltipText: "Total refund initiated",
        deltaTooltipComponent: AnalyticsUtils.singlestatDeltaTooltipFormat(
          singleStatData.refund_count,
          deltaTimestampData.currentSr,
        ),
        value: singleStatData.refund_count,
        delta: Number(singleStatData.refund_count.toFixed(2)),
        data: constructData("refund_count", timeSeriesData),
        statType: "Volume",
        showDelta: false,
      };
    case "SuccessCount":
      return {
        title: "Success Refunds",
        tooltipText: "Total successful refunds",
        deltaTooltipComponent: AnalyticsUtils.singlestatDeltaTooltipFormat(
          singleStatData.refund_success_count,
          deltaTimestampData.currentSr,
        ),
        value: singleStatData.refund_success_count,
        delta: Number(singleStatData.refund_success_count.toFixed(2)),
        data: constructData("refund_success_count", timeSeriesData),
        statType: "Volume",
        showDelta: false,
      };
    case "ProcessedAmount":
      return {
        title: "Processed Amount",
        tooltipText: "Total amount processed successfully",
        deltaTooltipComponent: AnalyticsUtils.singlestatDeltaTooltipFormat(
          singleStatData.refund_processed_amount / 100.0,
          deltaTimestampData.currentSr,
        ),
        value: singleStatData.refund_processed_amount / 100.0,
        delta: Number(
          (singleStatData.refund_processed_amount / 100.0).toFixed(2),
        ),
        data: constructData("refund_processed_amount", timeSeriesData),
        statType: "Amount",
        showDelta: false,
      };
  }
}

var getStatSentiment = Object.fromEntries([
  ["Success Refunds", "Negative"],
  ["Overall Refunds", "Negative"],
  ["Processed Amount", "Negative"],
]);

function getSingleStatEntity(metrics) {
  return {
    urlConfig: [
      {
        uri: window._env_.apiBaseUrl + "/analytics/v1/metrics/" + domain,
        metrics: HSAnalyticsUtils.getStringListFromArrayDict(metrics),
      },
    ],
    getObjects: itemToObjMapper,
    getTimeSeriesObject: timeSeriesObjMapper,
    defaultColumns: defaultColumns,
    getData: getStatData,
    matrixUriMapper: function (param) {
      return window._env_.apiBaseUrl + "/analytics/v1/metrics/" + domain;
    },
    statSentiment: getStatSentiment,
  };
}

var metricsConfig = [
  {
    metric_name_db: "refund_success_rate",
    metric_label: "Success Rate",
    metric_type: "Rate",
  },
  {
    metric_name_db: "refund_count",
    metric_label: "Volume",
    metric_type: "Volume",
  },
];

function chartEntity(tabKeys) {
  return DynamicChart.makeEntity(
    {
      TAG: "String",
      _0: window._env_.apiBaseUrl + "/analytics/v1/metrics/" + domain,
    },
    undefined,
    tabKeys,
    [HSAnalyticsUtils.startTimeFilterKey, HSAnalyticsUtils.endTimeFilterKey],
    ["refund_success_rate", "refund_count"],
    [],
    [],
    ["Line"],
    [
      {
        uri: window._env_.apiBaseUrl + "/analytics/v1/metrics/" + domain,
        timeSeriesBody: DynamicChart.getTimeSeriesChart,
        legendBody: DynamicChart.getLegendBody,
        metrics: metricsConfig,
        timeCol: "time_bucket",
        filterKeys: tabKeys,
      },
    ],
    "Refunds Analytics",
    undefined,
    undefined,
    undefined,
    undefined,
    undefined,
    undefined,
    undefined,
    undefined,
    undefined,
  );
}

export {
  domain,
  colMapper,
  tableItemToObjMapper,
  getUpdatedHeading,
  getCell,
  getRefundTable,
  refundTableEntity,
  singleStateInitialValue,
  singleStateSeriesInitialValue,
  singleStateItemToObjMapper,
  singleStateSeriesItemToObjMapper,
  itemToObjMapper,
  timeSeriesObjMapper,
  defaultColumns,
  compareLogic,
  constructData,
  getStatData,
  getStatSentiment,
  getSingleStatEntity,
  metricsConfig,
  chartEntity,
};
/* defaultColumns Not a pure module */
