// Generated by ReScript, PLEASE EDIT WITH CARE

import * as React from "react";
import * as Loader from "../../../components/Loader.bs.js";
import * as BasicAuthUtils from "./BasicAuthUtils.bs.js";
import * as BasicAuthScreen from "./BasicAuthScreen.bs.js";
import * as AuthInfoProvider from "../../../context/AuthInfoProvider.bs.js";
import * as RescriptReactRouter from "@rescript/react/src/RescriptReactRouter.bs.js";

function BasicAuthWrapper(props) {
  var children = props.children;
  var url = RescriptReactRouter.useUrl(undefined, undefined);
  var match = React.useContext(AuthInfoProvider.authStatusContext);
  var setAuthStateToLogout = match.setAuthStateToLogout;
  var setAuthStatus = match.setAuthStatus;
  React.useEffect(function () {
    var match = url.path;
    var exit = 0;
    if (match) {
      switch (match.hd) {
        case "register":
          if (match.tl) {
            exit = 1;
          } else {
            setAuthStateToLogout();
          }
          break;
        case "user":
          var match$1 = match.tl;
          if (match$1) {
            var exit$1 = 0;
            switch (match$1.hd) {
              case "accept_invite_from_email":
              case "login":
              case "set_password":
              case "verify_email":
                exit$1 = 2;
                break;
              default:
                exit = 1;
            }
            if (exit$1 === 2) {
              if (match$1.tl) {
                exit = 1;
              } else {
                setAuthStateToLogout();
              }
            }
          } else {
            exit = 1;
          }
          break;
        default:
          exit = 1;
      }
    } else {
      exit = 1;
    }
    if (exit === 1) {
      var authInfo = BasicAuthUtils.getBasicAuthInfoFromStrorage();
      var match$2 = authInfo.token;
      if (match$2 !== undefined) {
        setAuthStatus({
          TAG: "LoggedIn",
          _0: {
            TAG: "BasicAuth",
            _0: authInfo,
          },
        });
      } else {
        setAuthStateToLogout();
      }
    }
  }, []);
  var tmp;
  var tmp$1 = match.authStatus;
  tmp =
    typeof tmp$1 !== "object"
      ? tmp$1 === "LoggedOut"
        ? React.createElement(BasicAuthScreen.make, {})
        : React.createElement(Loader.make, {})
      : children;
  return React.createElement(
    "div",
    {
      className: "font-inter-style",
    },
    tmp,
  );
}

var make = BasicAuthWrapper;

export { make };
/* react Not a pure module */
