// Generated by ReScript, PLEASE EDIT WITH CARE

import * as React from "react";
import * as Recoil from "recoil";
import * as RenderIf from "../../../utils/RenderIf.bs.js";
import * as AuthUtils from "../AuthUtils.bs.js";
import * as BasicAuth from "./BasicAuth.bs.js";
import * as CommonAuth from "../Common/CommonAuth.bs.js";
import * as GlobalVars from "../../../utils/GlobalVars.bs.js";
import * as Caml_option from "rescript/lib/es6/caml_option.js";
import * as HSwitchUtils from "../../../screens/HSwitchUtils.bs.js";
import * as FramerMotion from "framer-motion";
import * as CommonAuthUtils from "../Common/CommonAuthUtils.bs.js";
import * as HyperSwitchLogo from "../../../components/HyperSwitchLogo.bs.js";
import * as HyperswitchAtom from "../../../Recoils/HyperswitchAtom.bs.js";
import * as RescriptReactRouter from "@rescript/react/src/RescriptReactRouter.bs.js";
import * as BasicInviteFromEmail from "./BasicInviteFromEmail.bs.js";
import * as BasicEmailVerifyScreen from "./BasicEmailVerifyScreen.bs.js";

function BasicAuthScreen$BasicAuthPage(props) {
  var setAuthType = props.setAuthType;
  var authType = props.authType;
  var match = Recoil.useRecoilValue(HyperswitchAtom.featureFlagAtom);
  var branding = match.branding;
  var match$1 = window._env_.logoUrl;
  var match$2 =
    match$1 !== undefined
      ? ["IconWithURL", match$1]
      : ["IconWithText", undefined];
  var screen = React.createElement(
    "div",
    {
      className:
        "h-full flex flex-col items-center justify-between overflow-scoll text-grey-0 w-full mobile:w-30-rem",
    },
    React.createElement(
      "div",
      {
        className: "flex flex-col items-center gap-6 flex-1 mt-4 mobile:my-20",
      },
      React.createElement(RenderIf.make, {
        condition: match.testLiveToggle,
        children: React.createElement(CommonAuthUtils.ToggleLiveTestMode.make, {
          authType: authType,
          mode: props.mode,
          setMode: props.setMode,
          setAuthType: setAuthType,
        }),
      }),
      React.createElement(
        FramerMotion.motion.div,
        {
          className: "bg-white w-full text-black mobile:border rounded-lg",
          layoutId: "form",
          children: Caml_option.some(null),
        },
        React.createElement(
          "div",
          {
            className: "px-7 py-6",
          },
          React.createElement(FramerMotion.motion.div, {
            layoutId: "logo",
            children: Caml_option.some(
              React.createElement(HyperSwitchLogo.make, {
                logoVariant: match$2[0],
                logoHeight: "h-8",
                theme: "Dark",
                iconUrl: Caml_option.some(match$2[1]),
              }),
            ),
          }),
        ),
        React.createElement(FramerMotion.motion.div, {
          className: "border-b w-full",
          layoutId: "border",
        }),
        React.createElement(
          "div",
          {
            className: "p-7",
          },
          React.createElement(BasicAuth.make, {
            authType: authType,
            setAuthType: setAuthType,
          }),
        ),
      ),
      React.createElement(RenderIf.make, {
        condition: !branding,
        children: React.createElement(FramerMotion.motion.div, {
          className:
            "justify-center text-sm mobile:text-base flex flex-col mobile:flex-row mobile:gap-3 items-center w-full max-w-xl text-center",
          layoutId: "footer-links",
          children: Caml_option.some(
            React.createElement(CommonAuth.TermsAndCondition.make, {}),
          ),
        }),
      }),
    ),
    React.createElement(RenderIf.make, {
      condition: !branding,
      children: React.createElement(CommonAuth.PageFooterSection.make, {}),
    }),
  );
  return React.createElement(HSwitchUtils.BackgroundImageWrapper.make, {
    children: Caml_option.some(screen),
    customPageCss: "flex flex-col items-center justify-center overflow-scroll",
  });
}

var BasicAuthPage = {
  make: BasicAuthScreen$BasicAuthPage,
};

function BasicAuthScreen(props) {
  var url = RescriptReactRouter.useUrl(undefined, undefined);
  var match = React.useState(function () {
    return "TestButtonMode";
  });
  var setMode = match[1];
  var match$1 = Recoil.useRecoilValue(HyperswitchAtom.featureFlagAtom);
  var isLiveMode = match$1.isLiveMode;
  var isMagicLinkEnabled = match$1.email;
  var authInitState = isMagicLinkEnabled
    ? "LoginWithEmail"
    : "LoginWithPassword";
  var match$2 = React.useState(function () {
    return authInitState;
  });
  var setAuthType = match$2[1];
  var authType = match$2[0];
  var match$3 = React.useState(function () {
    return authInitState;
  });
  var setActualAuthType = match$3[1];
  var actualAuthType = match$3[0];
  React.useEffect(
    function () {
      if (isLiveMode) {
        setMode(function (param) {
          return "LiveButtonMode";
        });
      } else {
        setMode(function (param) {
          return "TestButtonMode";
        });
      }
      var match = url.path;
      if (match) {
        switch (match.hd) {
          case "forget-password":
            if (match.tl) {
            } else {
              setActualAuthType(function (param) {
                return "ForgetPassword";
              });
            }
            break;
          case "login":
            if (match.tl) {
            } else {
              setActualAuthType(function (param) {
                if (isMagicLinkEnabled) {
                  return "LoginWithEmail";
                } else {
                  return "LoginWithPassword";
                }
              });
            }
            break;
          case "register":
            if (match.tl) {
            } else if (isLiveMode) {
              AuthUtils.redirectToLogin();
            } else {
              setActualAuthType(function (param) {
                return "SignUP";
              });
            }
            break;
          case "user":
            var match$1 = match.tl;
            if (match$1) {
              switch (match$1.hd) {
                case "accept_invite_from_email":
                  if (match$1.tl) {
                  } else {
                    setActualAuthType(function (param) {
                      return "ActivateFromEmail";
                    });
                  }
                  break;
                case "set_password":
                  if (match$1.tl) {
                  } else {
                    setActualAuthType(function (param) {
                      return "ResetPassword";
                    });
                  }
                  break;
                case "verify_email":
                  if (match$1.tl) {
                  } else {
                    setActualAuthType(function (param) {
                      return "EmailVerify";
                    });
                  }
                  break;
                default:
              }
            }
            break;
          default:
        }
      }
    },
    [url.path],
  );
  React.useEffect(
    function () {
      if (authType !== actualAuthType) {
        setAuthType(function (param) {
          return actualAuthType;
        });
      }
    },
    [actualAuthType],
  );
  React.useEffect(
    function () {
      var match = url.path;
      var exit = 0;
      switch (authType) {
        case "LoginWithPassword":
        case "LoginWithEmail":
          exit = 1;
          break;
        case "SignUP":
          if (!(match && match.hd === "register")) {
            RescriptReactRouter.push(
              GlobalVars.appendDashboardPath("/register"),
            );
          }
          break;
        case "ForgetPassword":
        case "ForgetPasswordEmailSent":
          exit = 2;
          break;
        case "ResendVerifyEmailSent":
        case "ResendVerifyEmail":
          exit = 3;
          break;
        default:
      }
      switch (exit) {
        case 1:
          if (match) {
            switch (match.hd) {
              case "register":
                break;
              case "user":
                var match$1 = match.tl;
                if (match$1) {
                  var exit$1 = 0;
                  switch (match$1.hd) {
                    case "accept_invite_from_email":
                    case "login":
                    case "set_password":
                    case "verify_email":
                      exit$1 = 4;
                      break;
                    default:
                      AuthUtils.redirectToLogin();
                  }
                  if (exit$1 === 4) {
                    if (match$1.tl) {
                      AuthUtils.redirectToLogin();
                    }
                  }
                } else {
                  AuthUtils.redirectToLogin();
                }
                break;
              default:
                AuthUtils.redirectToLogin();
            }
          } else {
            AuthUtils.redirectToLogin();
          }
          break;
        case 2:
          if (!(match && match.hd === "forget-password")) {
            RescriptReactRouter.push(
              GlobalVars.appendDashboardPath("/forget-password"),
            );
          }
          break;
        case 3:
          if (!(match && match.hd === "resend-mail")) {
            RescriptReactRouter.push(
              GlobalVars.appendDashboardPath("/resend-mail"),
            );
          }
          break;
      }
    },
    [authType],
  );
  switch (authType) {
    case "EmailVerify":
    case "MagicLinkVerify":
      return React.createElement(BasicEmailVerifyScreen.make, {
        setAuthType: setAuthType,
      });
    case "ActivateFromEmail":
      return React.createElement(BasicInviteFromEmail.make, {
        setAuthType: setAuthType,
      });
    default:
      return React.createElement(BasicAuthScreen$BasicAuthPage, {
        authType: authType,
        setAuthType: setAuthType,
        mode: match[0],
        setMode: setMode,
      });
  }
}

var make = BasicAuthScreen;

export { BasicAuthPage, make };
/* react Not a pure module */
